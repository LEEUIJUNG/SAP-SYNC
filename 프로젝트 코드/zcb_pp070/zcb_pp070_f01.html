<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
<title>ZCB_PP070_F01</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZCB_PP070_F01</h2>
<h3> Description: SUB</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZCB_PP070_F01<br />
*&---------------------------------------------------------------------*<br />
<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;call_scr_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SCR0100&nbsp;을&nbsp;호출한다.<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;call_scr_0100.<br />
&nbsp;&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;0100.<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;get_selected_data<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SS&nbsp;에서&nbsp;검색받은&nbsp;검색&nbsp;조건을&nbsp;조회한다<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;get_selected_data&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;검색받은&nbsp;plant&nbsp;기준으로&nbsp;AFKO,&nbsp;AFPO를&nbsp;&nbsp;검색한다.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_where&nbsp;&nbsp;TYPE&nbsp;string.<br />
<br />
&nbsp;&nbsp;&nbsp;lv_where&nbsp;=&nbsp;|a~werks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;@pa_werks&nbsp;AND&nbsp;a~gltrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;@so_gltrs&nbsp;AND&nbsp;a~gltrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;=&nbsp;@sy-datum&nbsp;AND&nbsp;a~charg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;''&nbsp;AND&nbsp;a~lvorm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;''&nbsp;AND&nbsp;a~approval&nbsp;&nbsp;=&nbsp;'X'|.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;pa_aufnr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_where&nbsp;=&nbsp;&nbsp;|&nbsp;{&nbsp;lv_where&nbsp;}&nbsp;AND&nbsp;a~aufnr&nbsp;=&nbsp;@pa_aufnr&nbsp;|.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;pa_matnr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_where&nbsp;=&nbsp;|&nbsp;{&nbsp;lv_where&nbsp;}&nbsp;AND&nbsp;a~plnbez&nbsp;=&nbsp;@pa_matnr&nbsp;|.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*&nbsp;생산오더&nbsp;해더&nbsp;검색&nbsp;+&nbsp;자재명<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~aufnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산오더&nbsp;번호<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~plnbez,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산자재<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~werks,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산공장<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~gamng,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;계획생산&nbsp;수량<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~meins,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산&nbsp;단위<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~plnnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정번호<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~stlnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;bom번호<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~lgort,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산자재&nbsp;입고<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~aprio,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;긴급오더<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~gltrs,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;시작&nbsp;계획일자<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~gstrs,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;종료&nbsp;계획일자<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~lvorm,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;삭제여부<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~approval,&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;승인여부<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b~maktx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;자재명<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@gt_afko<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_afko&nbsp;AS&nbsp;a<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;zcb_makt&nbsp;AS&nbsp;b<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;a~plnbez&nbsp;=&nbsp;b~matnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;b~spras&nbsp;=&nbsp;@sy-langu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;(lv_where)&nbsp;.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e400(zcb_msg)&nbsp;WITH&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_afko&nbsp;BY&nbsp;aufnr.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;AUFNR&nbsp;목록&nbsp;추출<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_aufnr&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;zcb_aufnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_aufnr&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_aufnr.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lt_aufnr.<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_afko&nbsp;INTO&nbsp;DATA(ls_afko).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_aufnr-sign&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_aufnr-option&nbsp;=&nbsp;'EQ'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_aufnr-low&nbsp;=&nbsp;ls_afko-aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_aufnr&nbsp;TO&nbsp;lt_aufnr.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;생산오더&nbsp;아이탬&nbsp;검색<br />
*&nbsp;해더에&nbsp;있는&nbsp;생산오더만&nbsp;가지고옴<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aufnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산오더&nbsp;번호<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;posnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산순서<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;werks,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산공장<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plnkn,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정단계<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arbpl,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산&nbsp;작업장<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;투입&nbsp;자재<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wemng,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;투입수량<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meins,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;단위<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgort,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;재료&nbsp;출고&nbsp;위치<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvorm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;삭제&nbsp;여부<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_afpo<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@gt_afpo<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;werks&nbsp;=&nbsp;@pa_werks<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;aufnr&nbsp;IN&nbsp;@lt_aufnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;lvorm&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e400(zcb_msg)&nbsp;WITH&nbsp;'ZCB_AFPO'.<br />
&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_afpo&nbsp;BY&nbsp;aufnr.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;AFKO&nbsp;필드&nbsp;정보&nbsp;추가<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pratio&nbsp;&nbsp;&nbsp;공정단계<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arbpl&nbsp;&nbsp;&nbsp;&nbsp;작업장<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pratio&nbsp;&nbsp;&nbsp;공정&nbsp;진행률<br />
<br />
*&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_afko&nbsp;LIKE&nbsp;gs_afko.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_afpo&nbsp;LIKE&nbsp;gs_afpo.<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_afko&nbsp;INTO&nbsp;ls_afko.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;초기값&nbsp;설정<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-porder&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-pratio&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-icon&nbsp;&nbsp;&nbsp;=&nbsp;icon_led_red.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;해당&nbsp;오더의&nbsp;공정&nbsp;중&nbsp;첫&nbsp;작업장&nbsp;+&nbsp;마지막&nbsp;행번호&nbsp;가져오기<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA(lv_last_plnkn)&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;ls_afpo.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_afpo&nbsp;INTO&nbsp;ls_afpo&nbsp;WHERE&nbsp;aufnr&nbsp;=&nbsp;ls_afko-aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_last_plnkn&nbsp;&lt;&nbsp;ls_afpo-plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_last_plnkn&nbsp;=&nbsp;ls_afpo-plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;최초&nbsp;1건의&nbsp;작업장만&nbsp;설정<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_afko-arbpl&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-arbpl&nbsp;=&nbsp;ls_afpo-arbpl.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정단계가&nbsp;10의&nbsp;단위로&nbsp;설정&nbsp;(&nbsp;새부&nbsp;공정&nbsp;있을경우&nbsp;1번&nbsp;할당하려&nbsp;했는데&nbsp;없음)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-polast&nbsp;=&nbsp;lv_last_plnkn.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;실제&nbsp;생산&nbsp;시작일&nbsp;입력<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-gstri&nbsp;=&nbsp;sy-datum.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_afko&nbsp;FROM&nbsp;ls_afko&nbsp;TRANSPORTING&nbsp;icon&nbsp;porder&nbsp;pratio&nbsp;polast&nbsp;arbpl&nbsp;gstri.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;check_select_option<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;검색&nbsp;조건&nbsp;점검<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;check_select_option&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;플랜트는&nbsp;입력이&nbsp;되어&nbsp;있어야함.<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;pa_werks&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산&nbsp;플랜트를&nbsp;입력해주세요.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e441(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;so_gltrs&nbsp;INTO&nbsp;DATA(ls_gltrs).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;검색일자가&nbsp;과거&nbsp;시점이면&nbsp;에러&nbsp;발생<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_gltrs-low&nbsp;&lt;&nbsp;sy-datum.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;계획일자는&nbsp;오늘&nbsp;이후로만&nbsp;입력할&nbsp;수&nbsp;있습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e442(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;만약&nbsp;high&nbsp;에&nbsp;과거&nbsp;시점을&nbsp;검색해도&nbsp;에러&nbsp;발생<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_gltrs-high&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;AND&nbsp;ls_gltrs-high&nbsp;&lt;=&nbsp;sy-datum.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;일자범위를&nbsp;알맞게&nbsp;입력해&nbsp;주세요.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e474(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_parm_werks<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SS&nbsp;WERKS&nbsp;PARM&nbsp;에서&nbsp;공장&nbsp;관련&nbsp;플랜트만&nbsp;검색&nbsp;가능하게<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_parm_werks&nbsp;.<br />
&nbsp;&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;ty_werks_help,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;werks&nbsp;TYPE&nbsp;zcb_t001w-werks,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name1&nbsp;TYPE&nbsp;zcb_t001w-name1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_werks_help.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_list&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ty_werks_help,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_return&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ddshretval,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_fields&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;dfies,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_field&nbsp;&nbsp;TYPE&nbsp;dfies.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;VLFKZ&nbsp;=&nbsp;'A'&nbsp;조건만&nbsp;조회<br />
&nbsp;&nbsp;&nbsp;SELECT&nbsp;werks,&nbsp;name1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@lt_list<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_t001w<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;vlfkz&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;F4&nbsp;인터페이스&nbsp;팝업&nbsp;호출<br />
&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retfield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'WERKS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpprog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-repid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-dynnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynprofield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'PA_WERKS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_org&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_list<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_return<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_fields<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter_error&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_values_found&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_parm_matnr<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;완제품과&nbsp;역&nbsp;BOM&nbsp;(RM102)&nbsp;만&nbsp;생산&nbsp;가능하게<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_parm_matnr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;ty_matnr_help,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matnr&nbsp;TYPE&nbsp;zcb_mara-matnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maktx&nbsp;TYPE&nbsp;zcb_makt-maktx,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_matnr_help.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_list&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ty_matnr_help,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_return&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ddshretval,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_fields&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;dfies,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_field&nbsp;&nbsp;TYPE&nbsp;dfies.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;완제품만&nbsp;조회&nbsp;역&nbsp;BOM&nbsp;도&nbsp;추가<br />
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~matnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b~maktx<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@lt_list<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_mara&nbsp;AS&nbsp;a<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;zcb_makt&nbsp;AS&nbsp;b<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;a~matnr&nbsp;=&nbsp;b~matnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;b~spras&nbsp;=&nbsp;@sy-langu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;a~mtart&nbsp;=&nbsp;'FERT'&nbsp;OR&nbsp;a~matnr&nbsp;=&nbsp;'RM102'&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;F4&nbsp;인터페이스&nbsp;팝업&nbsp;호출<br />
&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retfield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'MATNR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpprog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-repid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-dynnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynprofield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'PA_MATNR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_org&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_list<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_return<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_fields<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter_error&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_values_found&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_parm_aufnr<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;오늘&nbsp;이전&nbsp;생산계획&nbsp;검색&nbsp;막기<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_parm_aufnr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;ty_aufnr_help,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aufnr&nbsp;&nbsp;TYPE&nbsp;zcb_aufnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plnbez&nbsp;TYPE&nbsp;zcb_matnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maktx&nbsp;&nbsp;TYPE&nbsp;zcb_makt-maktx,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;werks&nbsp;&nbsp;TYPE&nbsp;zcb_werks_d,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gltrs&nbsp;&nbsp;TYPE&nbsp;zcb_gltrs,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_aufnr_help.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_list&nbsp;&nbsp;&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ty_aufnr_help,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_return&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ddshretval,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_fields&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;dfies,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_field&nbsp;&nbsp;TYPE&nbsp;dfies.<br />
<br />
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~aufnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~plnbez,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b~maktx,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~werks,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~gltrs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@lt_list<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_afko&nbsp;AS&nbsp;a<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;zcb_makt&nbsp;AS&nbsp;b<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;a~plnbez&nbsp;=&nbsp;b~matnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;b~spras&nbsp;=&nbsp;@sy-langu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~gltrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;=&nbsp;@sy-datum<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;a~charg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;a~lvorm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;a~approval&nbsp;&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;F4&nbsp;인터페이스&nbsp;팝업&nbsp;호출<br />
&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'F4IF_INT_TABLE_VALUE_REQUEST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retfield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'AUFNR'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpprog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-repid<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-dynnr<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynprofield&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'PA_AUFNR'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_org&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_choice&nbsp;=&nbsp;space<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_list<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_return<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_fields<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter_error&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_values_found&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;"검색을&nbsp;도와주도록&nbsp;input&nbsp;field&nbsp;채움<br />
&nbsp;&nbsp;&nbsp;"&nbsp;내가&nbsp;선택한&nbsp;서치핼프&nbsp;값&nbsp;기준으로<br />
<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;lt_return[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_return&nbsp;INTO&nbsp;DATA(ls_return)&nbsp;INDEX&nbsp;1.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_list&nbsp;INTO&nbsp;DATA(ls_list)&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_return-fieldval.<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_update&nbsp;TYPE&nbsp;dynpread,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_update&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;dynpread.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_update.<br />
&nbsp;&nbsp;&nbsp;ls_update-fieldname&nbsp;=&nbsp;'PA_WERKS'.<br />
&nbsp;&nbsp;&nbsp;ls_update-fieldvalue&nbsp;=&nbsp;ls_list-werks.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_update&nbsp;TO&nbsp;lt_update.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_update.<br />
&nbsp;&nbsp;&nbsp;ls_update-fieldname&nbsp;=&nbsp;'PA_AUFNR'.<br />
&nbsp;&nbsp;&nbsp;ls_update-fieldvalue&nbsp;=&nbsp;ls_list-aufnr.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_update&nbsp;TO&nbsp;lt_update.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_update.<br />
&nbsp;&nbsp;&nbsp;ls_update-fieldname&nbsp;=&nbsp;'SO_GLTRS-LOW'.<br />
&nbsp;&nbsp;&nbsp;ls_update-fieldvalue&nbsp;=&nbsp;ls_list-gltrs.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_update&nbsp;TO&nbsp;lt_update.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_update.<br />
&nbsp;&nbsp;&nbsp;ls_update-fieldname&nbsp;=&nbsp;'PA_MATNR'.<br />
&nbsp;&nbsp;&nbsp;ls_update-fieldvalue&nbsp;=&nbsp;ls_list-plnbez.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_update&nbsp;TO&nbsp;lt_update.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;화면&nbsp;input&nbsp;field에&nbsp;선택&nbsp;값들을&nbsp;UPDATE&nbsp;한다.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'DYNP_VALUES_UPDATE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dyname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-cprog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Program&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynumb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-dynnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Screen&nbsp;number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynpfields&nbsp;=&nbsp;lt_update.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Screen&nbsp;field&nbsp;value&nbsp;reset&nbsp;table<br />
<br />
&nbsp;&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_afko_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SET&nbsp;AFKO&nbsp;LAYO&nbsp;FCAT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_afko_0100.<br />
&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_layo1,&nbsp;gs_variant1&nbsp;,&nbsp;gt_fcat1.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_variant1-report&nbsp;=&nbsp;sy-cprog.<br />
&nbsp;&nbsp;&nbsp;gs_variant1-handle&nbsp;=&nbsp;'AFKO'.<br />
<br />
&nbsp;&nbsp;&nbsp;gv_save1&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_layo1-sel_mode&nbsp;=&nbsp;'B'.&nbsp;"&nbsp;CELL&nbsp;단위&nbsp;선택가능<br />
&nbsp;&nbsp;&nbsp;gs_layo1-zebra&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;얼룩처리<br />
&nbsp;&nbsp;&nbsp;gs_layo1-grid_title&nbsp;=&nbsp;'생산오더&nbsp;목록'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;gs_layo1-stylefname&nbsp;=&nbsp;'CELLTAB'.<br />
*&nbsp;&nbsp;gs_layo3-cwidth_opt&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;열넓이&nbsp;최적화&nbsp;샐&nbsp;넓이가&nbsp;고정이&nbsp;되어버림&nbsp;최적으로<br />
*&nbsp;&nbsp;gs_layo1-edit&nbsp;=&nbsp;''.&nbsp;"&nbsp;수정모드&nbsp;전체&nbsp;필드가&nbsp;수정&nbsp;가능하게&nbsp;되어짐<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;미사용&nbsp;필드<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
*&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'APPROV_T'.<br />
*&nbsp;&nbsp;gs_fcat1-no_out&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;사용할&nbsp;필드<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'ICON'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-icon&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-emphasize&nbsp;=&nbsp;'C110'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'AUFNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'생산오더'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_field&nbsp;=&nbsp;'AUFNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'PLNBEZ'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'자재번호'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_field&nbsp;=&nbsp;'PLNBEZ'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'MAKTX'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'자재설명'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;12.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_table&nbsp;=&nbsp;'ZCB_MAKT'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_field&nbsp;=&nbsp;'ZCB_MAKTX'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'생산수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'단위'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_field&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'PORDER'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'진행'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-ref_field&nbsp;=&nbsp;'PORDER'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'POLAST'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'최종'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'ARBPL'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'진행공정'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;6.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat1-ref_table&nbsp;=&nbsp;'ZCB_CRHD'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat1-ref_field&nbsp;=&nbsp;'ARBPL'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
*&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'PRATIO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-coltext&nbsp;=&nbsp;'진행률'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-outputlen&nbsp;&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;&nbsp;gs_fcat1-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
&nbsp;ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_grid_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;ALV&nbsp;를&nbsp;설정한다.<br />
*&---------------------------------------------------------------------*<br />
<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_grid_0100&nbsp;&nbsp;USING&nbsp;p_structure&nbsp;TYPE&nbsp;dd02l-tabname<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ps_variant&nbsp;TYPE&nbsp;disvariant<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_save&nbsp;TYPE&nbsp;c<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ps_layo&nbsp;TYPE&nbsp;&nbsp;&nbsp;lvc_s_layo<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_ccon&nbsp;TYPE&nbsp;&nbsp;scrfname<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;ct_outtab&nbsp;TYPE&nbsp;ANY&nbsp;TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ct_fieldcat&nbsp;TYPE&nbsp;lvc_t_fcat<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ct_filter&nbsp;&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvc_t_filt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ct_sort&nbsp;&nbsp;&nbsp;TYPE&nbsp;lvc_t_sort<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;co_container&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cl_gui_custom_container<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;co_alv_grid&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;&nbsp;cl_gui_alv_grid.<br />
&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;co_container<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;p_ccon&nbsp;"&nbsp;Name&nbsp;of&nbsp;the&nbsp;Screen&nbsp;CustCtrl&nbsp;Name&nbsp;to&nbsp;Link&nbsp;Container&nbsp;To<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;"&nbsp;CNTL_ERROR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_system_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2&nbsp;"&nbsp;CNTL_SYSTEM_ERROR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3&nbsp;"&nbsp;CREATE_ERROR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lifetime_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4&nbsp;"&nbsp;LIFETIME_ERROR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lifetime_dynpro_dynpro_link&nbsp;=&nbsp;5&nbsp;"&nbsp;LIFETIME_DYNPRO_DYNPRO_LINK<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;프로그램&nbsp;중단되도록&nbsp;A&nbsp;타입&nbsp;메시지를&nbsp;쓴다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;Container&nbsp;객체&nbsp;생성&nbsp;중&nbsp;오류가&nbsp;발생했습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;a001(zcb_msg)&nbsp;DISPLAY&nbsp;LIKE&nbsp;'i'.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;co_alv_grid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_parent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;co_container&nbsp;&nbsp;"&nbsp;Parent&nbsp;Container<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_cntl_create&nbsp;=&nbsp;1&nbsp;&nbsp;"&nbsp;Error&nbsp;when&nbsp;creating&nbsp;the&nbsp;control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_cntl_init&nbsp;&nbsp;&nbsp;=&nbsp;2&nbsp;&nbsp;"&nbsp;Error&nbsp;While&nbsp;Initializing&nbsp;Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_cntl_link&nbsp;&nbsp;&nbsp;=&nbsp;3&nbsp;&nbsp;"&nbsp;Error&nbsp;While&nbsp;Linking&nbsp;Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_dp_create&nbsp;&nbsp;&nbsp;=&nbsp;4&nbsp;&nbsp;"&nbsp;Error&nbsp;While&nbsp;Creating&nbsp;DataProvider&nbsp;Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ALV&nbsp;객체&nbsp;생성&nbsp;중&nbsp;오류가&nbsp;발생했습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;a002(zcb_msg)&nbsp;DISPLAY&nbsp;LIKE&nbsp;'i'.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;p_structure&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;실제&nbsp;테이블로&nbsp;변경<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;co_alv_grid-&gt;set_table_for_first_display<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_variant&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_variant&nbsp;&nbsp;"&nbsp;Layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;p_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Save&nbsp;Layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_layout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_layo&nbsp;&nbsp;&nbsp;"&nbsp;Layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_outtab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ct_outtab<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_fieldcatalog&nbsp;=&nbsp;ct_fieldcat<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_filter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ct_filter<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_sort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ct_sort<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;실제&nbsp;테이블로&nbsp;변경<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Set&nbsp;data&nbsp;for&nbsp;top&nbsp;left&nbsp;grid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;co_alv_grid-&gt;set_table_for_first_display<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_structure_name&nbsp;=&nbsp;p_structure<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_variant&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_variant&nbsp;&nbsp;"&nbsp;Layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;p_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Save&nbsp;Layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_layout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_layo&nbsp;&nbsp;&nbsp;"&nbsp;Layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_outtab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ct_outtab<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_fieldcatalog&nbsp;&nbsp;=&nbsp;ct_fieldcat<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_filter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ct_filter<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_sort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ct_sort<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ALV&nbsp;객체에&nbsp;데이터&nbsp;및&nbsp;화면모양을&nbsp;전달하는&nbsp;과정&nbsp;중&nbsp;오류가&nbsp;발생했다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;a003(zcb_msg)&nbsp;DISPLAY&nbsp;LIKE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_event_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;ALV&nbsp;에&nbsp;이벤트&nbsp;핸들러&nbsp;등록<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_event_0100&nbsp;&nbsp;USING&nbsp;io_alv_grid&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cl_gui_alv_grid.<br />
&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;lcl_event_handler=&gt;on_toolbar&nbsp;FOR&nbsp;io_alv_grid.<br />
&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;lcl_event_handler=&gt;on_user_command&nbsp;FOR&nbsp;io_alv_grid.<br />
&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;lcl_event_handler=&gt;on_data_changed&nbsp;FOR&nbsp;io_alv_grid.<br />
&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;lcl_event_handler=&gt;on_data_changed_finished&nbsp;FOR&nbsp;io_alv_grid.<br />
<br />
&nbsp;&nbsp;&nbsp;io_alv_grid-&gt;register_edit_event(<br />
&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;i_event_id&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_evt_enter<br />
).<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Alv&nbsp;Event&nbsp;등록에&nbsp;실패했습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;a398(zcb_msg)&nbsp;DISPLAY&nbsp;LIKE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;alv_refresh_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;ALV&nbsp;Refresh&nbsp;초기화<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;alv_refresh_0100&nbsp;&nbsp;USING&nbsp;po_alv_grid&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cl_gui_alv_grid.<br />
&nbsp;&nbsp;&nbsp;po_alv_grid-&gt;refresh_table_display(<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_stable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;With&nbsp;Stable&nbsp;Rows/Columns<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_soft_refresh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'X'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Without&nbsp;Sort,&nbsp;Filter,&nbsp;etc.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;).<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e404(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;sched_plant<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;플랜트의&nbsp;하루치&nbsp;작업&nbsp;스케쥴링&nbsp;생성<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;sched_plant.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;gv_tick&nbsp;TYPE&nbsp;i&nbsp;VALUE&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;공정&nbsp;설명&nbsp;가져오기.<br />
&nbsp;&nbsp;&nbsp;DATA:lt_plpo&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_plpo.<br />
<br />
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plnnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plnkn,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltxa1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_plpo<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@lt_plpo<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;datub&nbsp;&gt;&nbsp;@sy-datum<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;datuv&nbsp;&lt;&nbsp;@sy-datum<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;lvorm&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ZCB_PLPO&nbsp;DB를&nbsp;가져오는데&nbsp;오류발생<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e400(zcb_msg)&nbsp;WITH&nbsp;'ZCB_PLPO'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;스케쥴링을&nbsp;위한&nbsp;key&nbsp;구조체<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;DATA:&nbsp;BEGIN&nbsp;OF&nbsp;gs_key,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aufnr&nbsp;TYPE&nbsp;zcb_aufnr,&nbsp;"&nbsp;Order&nbsp;number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;posid&nbsp;TYPE&nbsp;zcb_posnr,&nbsp;"&nbsp;Step&nbsp;ID&nbsp;(renamed&nbsp;from&nbsp;vornr)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plnkn&nbsp;TYPE&nbsp;zcb_plnkn,&nbsp;"&nbsp;Routing&nbsp;step<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;gs_key.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_step_keys&nbsp;&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;gs_key,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;전체&nbsp;공정&nbsp;정렬&nbsp;리스트<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_next_steps&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;gs_key,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;다음&nbsp;실행할&nbsp;step&nbsp;후보<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_done_steps&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;gs_key,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;실행&nbsp;완료된&nbsp;step<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_busy_arbpl&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_arbpl,&nbsp;&nbsp;&nbsp;"&nbsp;현재&nbsp;틱에서&nbsp;사용&nbsp;중인&nbsp;작업장<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;gs_key,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;gt_schedule,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;gt_afko,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afpo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;gt_afpo,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_conflict&nbsp;&nbsp;&nbsp;TYPE&nbsp;abap_bool,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_last_plnkn&nbsp;TYPE&nbsp;zcb_plnkn.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;전체&nbsp;공정&nbsp;(AFPO)에서&nbsp;step&nbsp;key&nbsp;구성<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_afpo&nbsp;INTO&nbsp;ls_afpo.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_key-aufnr&nbsp;=&nbsp;ls_afpo-aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_key-posid&nbsp;=&nbsp;ls_afpo-posnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_key-plnkn&nbsp;=&nbsp;ls_afpo-plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_key&nbsp;TO&nbsp;lt_step_keys.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;lt_step_keys&nbsp;COMPARING&nbsp;aufnr&nbsp;plnkn.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;각&nbsp;생산오더에&nbsp;대해&nbsp;최초&nbsp;routing&nbsp;등록<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_step_keys&nbsp;INTO&nbsp;ls_key.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_next_steps&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_key-aufnr&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_key&nbsp;TO&nbsp;lt_next_steps.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;틱&nbsp;단위&nbsp;스케줄&nbsp;생성<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;WHILE&nbsp;lines(&nbsp;lt_next_steps&nbsp;)&nbsp;&gt;&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lt_busy_arbpl.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_next_steps&nbsp;INTO&nbsp;ls_key.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_conflict&nbsp;=&nbsp;abap_false.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;현재&nbsp;틱에&nbsp;해당&nbsp;공정의&nbsp;작업장이&nbsp;사용&nbsp;중인지&nbsp;확인<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_afpo&nbsp;INTO&nbsp;ls_afpo&nbsp;WHERE&nbsp;aufnr&nbsp;=&nbsp;ls_key-aufnr&nbsp;AND&nbsp;plnkn&nbsp;=&nbsp;ls_key-plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_busy_arbpl&nbsp;WITH&nbsp;KEY&nbsp;table_line&nbsp;=&nbsp;ls_afpo-arbpl&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_conflict&nbsp;=&nbsp;abap_true.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_conflict&nbsp;=&nbsp;abap_true.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;해당&nbsp;공정을&nbsp;현재&nbsp;틱에&nbsp;할당<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_afpo&nbsp;INTO&nbsp;ls_afpo&nbsp;WHERE&nbsp;aufnr&nbsp;=&nbsp;ls_key-aufnr&nbsp;AND&nbsp;plnkn&nbsp;=&nbsp;ls_key-plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_sched.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-tick&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gv_tick.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_afpo-posnr&nbsp;=&nbsp;1&nbsp;AND&nbsp;ls_afpo-plnkn&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-ltxa2&nbsp;=&nbsp;'생산시작'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-ltxa2&nbsp;=&nbsp;'공정진행'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-aufnr&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-posnr&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-posnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-plnkn&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-arbpl&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-arbpl.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-matnr&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-matnr.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afko&nbsp;INTO&nbsp;DATA(ls_wa)&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_afpo-aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;역&nbsp;BOM&nbsp;의&nbsp;경우&nbsp;원재료&nbsp;-&gt;&nbsp;생산제품,&nbsp;생산제품&nbsp;-&gt;&nbsp;원재료&nbsp;역&nbsp;치환<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_wa-plnbez&nbsp;CP&nbsp;'RM1*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-product&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-quantity&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-wemng.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-unit&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-matnr&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-menge&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-wemng.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-meins&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afpo-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_afpo-matnr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-ltxa2&nbsp;=&nbsp;|{&nbsp;ls_sched-ltxa2&nbsp;},&nbsp;자재&nbsp;투입|.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afko&nbsp;INTO&nbsp;ls_afko&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_afpo-aufnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_plpo&nbsp;INTO&nbsp;DATA(ls_plpo)&nbsp;WITH&nbsp;KEY&nbsp;plnkn&nbsp;=&nbsp;ls_afpo-plnkn&nbsp;plnnr&nbsp;=&nbsp;ls_afko-plnnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-ltxa1&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_plpo-ltxa1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_sched&nbsp;TO&nbsp;gt_schedule.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_afpo-arbpl&nbsp;TO&nbsp;lt_busy_arbpl.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_key&nbsp;TO&nbsp;lt_done_steps.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;다음&nbsp;스텝&nbsp;후보&nbsp;리스트&nbsp;재구성<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lt_next_steps.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_step_keys&nbsp;INTO&nbsp;ls_key.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_done_steps&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_key-aufnr&nbsp;plnkn&nbsp;=&nbsp;ls_key-plnkn&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_next_steps&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_key-aufnr&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_key&nbsp;TO&nbsp;lt_next_steps.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;gv_tick.<br />
&nbsp;&nbsp;&nbsp;ENDWHILE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;생산&nbsp;제품&nbsp;정보&nbsp;추가&nbsp;(마지막&nbsp;step인&nbsp;경우만)<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;DATA(lv_last_posnr)&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule&nbsp;INTO&nbsp;ls_sched.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_last_plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_afpo&nbsp;INTO&nbsp;ls_afpo&nbsp;WHERE&nbsp;aufnr&nbsp;=&nbsp;ls_sched-aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_afpo-plnkn&nbsp;&gt;&nbsp;lv_last_plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_last_plnkn&nbsp;=&nbsp;ls_afpo-plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_last_posnr&nbsp;=&nbsp;ls_afpo-posnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_sched-plnkn&nbsp;=&nbsp;lv_last_plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afko&nbsp;INTO&nbsp;ls_afko&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_sched-aufnr.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;역&nbsp;BOM&nbsp;의&nbsp;경우&nbsp;원재료&nbsp;-&gt;&nbsp;생산제품,&nbsp;생산제품&nbsp;-&gt;&nbsp;원재료&nbsp;역&nbsp;치환<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_afko-plnbez&nbsp;CP&nbsp;'RM102*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-matnr&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afko-plnbez.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-menge&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afko-gamng.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-meins&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afko-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-product&nbsp;&nbsp;=&nbsp;ls_afko-plnbez.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-quantity&nbsp;=&nbsp;ls_afko-gamng.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-unit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afko-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_sched-posnr&nbsp;=&nbsp;lv_last_posnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_sched-ltxa2&nbsp;=&nbsp;|{&nbsp;ls_sched-ltxa2&nbsp;},&nbsp;생산완료|.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_schedule&nbsp;FROM&nbsp;ls_sched.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;가장&nbsp;마지막&nbsp;공정<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_process_end&nbsp;=&nbsp;ls_sched-tick.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;생산&nbsp;스테쥴&nbsp;TICK&nbsp;기준으로&nbsp;확인만을&nbsp;위해서&nbsp;틱당&nbsp;무슨&nbsp;공정인지만&nbsp;가지고&nbsp;있는&nbsp;TAB&nbsp;생성<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;gt_schedule_tick.<br />
&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_sched_tick.<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule&nbsp;INTO&nbsp;ls_sched.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_sched&nbsp;TO&nbsp;gs_sched_tick.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_sched_tick&nbsp;TO&nbsp;gt_schedule_tick.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_schedule_tick&nbsp;BY&nbsp;tick&nbsp;aufnr.<br />
&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;gt_schedule_tick&nbsp;COMPARING&nbsp;tick&nbsp;aufnr.<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;중복&nbsp;생산,&nbsp;&nbsp;소모&nbsp;물량&nbsp;투입&nbsp;내역&nbsp;제거<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_index&nbsp;TYPE&nbsp;sy-tabix,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_seen1&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_seen2&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_key&nbsp;&nbsp;&nbsp;TYPE&nbsp;string.<br />
<br />
&nbsp;&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;fs_sched&gt;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;gt_schedule.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;원자재(matnr)&nbsp;기준&nbsp;중복&nbsp;제거<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;DO&nbsp;lines(&nbsp;gt_schedule&nbsp;)&nbsp;TIMES.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;역방향으로&nbsp;뒤에부터&nbsp;체크&nbsp;(&nbsp;그래야&nbsp;맨&nbsp;뒤에가&nbsp;남음)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_index&nbsp;=&nbsp;lines(&nbsp;gt_schedule&nbsp;)&nbsp;-&nbsp;sy-index&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_schedule&nbsp;INDEX&nbsp;lv_index&nbsp;ASSIGNING&nbsp;&lt;fs_sched&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;fs_sched&gt;-matnr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;중복키&nbsp;검사용&nbsp;변수<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_key&nbsp;=&nbsp;|{&nbsp;&lt;fs_sched&gt;-tick&nbsp;}#{&nbsp;&lt;fs_sched&gt;-aufnr&nbsp;}#{&nbsp;&lt;fs_sched&gt;-matnr&nbsp;}#{&nbsp;&lt;fs_sched&gt;-menge&nbsp;}#{&nbsp;&lt;fs_sched&gt;-meins&nbsp;}|.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_seen1&nbsp;WITH&nbsp;TABLE&nbsp;KEY&nbsp;table_line&nbsp;=&nbsp;lv_key&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;동일한&nbsp;조합이&nbsp;있는&nbsp;경우<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;&lt;fs_sched&gt;-matnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_sched&gt;-menge,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_sched&gt;-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;처음&nbsp;나오는&nbsp;조합&nbsp;기록<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lv_key&nbsp;TO&nbsp;lt_seen1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;ENDDO.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;생산제품(product)&nbsp;기준&nbsp;중복&nbsp;제거<br />
*&nbsp;위와&nbsp;같음<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;DO&nbsp;lines(&nbsp;gt_schedule&nbsp;)&nbsp;TIMES.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_index&nbsp;=&nbsp;lines(&nbsp;gt_schedule&nbsp;)&nbsp;-&nbsp;sy-index&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_schedule&nbsp;INDEX&nbsp;lv_index&nbsp;ASSIGNING&nbsp;&lt;fs_sched&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;fs_sched&gt;-product&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_key&nbsp;=&nbsp;|{&nbsp;&lt;fs_sched&gt;-tick&nbsp;}#{&nbsp;&lt;fs_sched&gt;-aufnr&nbsp;}#{&nbsp;&lt;fs_sched&gt;-product&nbsp;}#{&nbsp;&lt;fs_sched&gt;-quantity&nbsp;}#{&nbsp;&lt;fs_sched&gt;-unit&nbsp;}|.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_seen2&nbsp;WITH&nbsp;TABLE&nbsp;KEY&nbsp;table_line&nbsp;=&nbsp;lv_key&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;&lt;fs_sched&gt;-product,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_sched&gt;-quantity,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_sched&gt;-unit.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lv_key&nbsp;TO&nbsp;lt_seen2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;ENDDO.<br />
<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_grid2_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SET&nbsp;GRID2&nbsp;LAYO&nbsp;FCAT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_grid2_0100.<br />
&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_layo2,&nbsp;gs_variant2&nbsp;,&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_variant2-report&nbsp;=&nbsp;sy-cprog.<br />
&nbsp;&nbsp;&nbsp;gs_variant2-handle&nbsp;=&nbsp;'GRID2'.<br />
<br />
&nbsp;&nbsp;&nbsp;gv_save2&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_layo2-sel_mode&nbsp;=&nbsp;'B'.&nbsp;"&nbsp;CELL&nbsp;단위&nbsp;선택가능<br />
&nbsp;&nbsp;&nbsp;gs_layo2-zebra&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;얼룩처리<br />
&nbsp;&nbsp;&nbsp;gs_layo2-grid_title&nbsp;=&nbsp;'생산&nbsp;LOG'.<br />
&nbsp;&nbsp;&nbsp;gs_layo2-info_fname&nbsp;=&nbsp;'COLOR'.&nbsp;"&nbsp;ROW&nbsp;색<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;gs_layo1-stylefname&nbsp;=&nbsp;'CELLTAB'.<br />
*&nbsp;&nbsp;gs_layo3-cwidth_opt&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;열넓이&nbsp;최적화&nbsp;샐&nbsp;넓이가&nbsp;고정이&nbsp;되어버림&nbsp;최적으로<br />
*&nbsp;&nbsp;gs_layo1-edit&nbsp;=&nbsp;''.&nbsp;"&nbsp;수정모드&nbsp;전체&nbsp;필드가&nbsp;수정&nbsp;가능하게&nbsp;되어짐<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tick&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;i,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;진행틱<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aufnr&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_aufnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산오더<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;posnr&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_posnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;AFPO&nbsp;행번호<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plnkn&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_PLNKN,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정순서<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arbpl&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_arbpl,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;할당&nbsp;작업장<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matnr&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_matnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;원재료<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menge&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_wemng,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;투입수량<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meins&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_meins,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;단위<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product&nbsp;&nbsp;TYPE&nbsp;zcb_matnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산자재<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantity&nbsp;TYPE&nbsp;zcb_wemng,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산수량<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_meins,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;단위<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltxa1&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_ltxa1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정설명<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltxa2&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_ltxa1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;틱&nbsp;설명<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;사용할&nbsp;필드<br />
&nbsp;&nbsp;&nbsp;"&nbsp;사용할&nbsp;필드<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'tick'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'No.'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'AUFNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'생산오더'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_field&nbsp;=&nbsp;'AUFNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'POSNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'순번'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_table&nbsp;=&nbsp;'ZCB_AFPO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_field&nbsp;=&nbsp;'POSNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'ARBPL'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'작업장'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_table&nbsp;=&nbsp;'ZCB_AFPO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_field&nbsp;=&nbsp;'ARBPL'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'PLNKN'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'공정단계'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_table&nbsp;=&nbsp;'ZCB_AFPO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_field&nbsp;=&nbsp;'PLNKN'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'LTXA1'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'공정&nbsp;설명'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;15.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'원자재&nbsp;번호'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'투입수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'단위'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'PRODUCT'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'생산자재&nbsp;번호'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'quantity'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'생산&nbsp;계획&nbsp;수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'UNIT'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'단위'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat2.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-fieldname&nbsp;=&nbsp;'LTXA2'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-coltext&nbsp;=&nbsp;'비고'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-outputlen&nbsp;&nbsp;=&nbsp;25.<br />
&nbsp;&nbsp;&nbsp;gs_fcat2-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat2&nbsp;TO&nbsp;gt_fcat2.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;check_mard_for_production<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;스캐쥴링&nbsp;결과&nbsp;필요자재,&nbsp;MARD&nbsp;보유&nbsp;자재&nbsp;비교<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;check_mard_for_production&nbsp;.<br />
&nbsp;&nbsp;&nbsp;"&nbsp;MARD&nbsp;에서&nbsp;필요&nbsp;자재&nbsp;재고&nbsp;데이터&nbsp;가져옴<br />
&nbsp;&nbsp;&nbsp;"&nbsp;필요자재량,&nbsp;창고재고&nbsp;수량&nbsp;비교<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;get_mard_data.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;get_mard_data<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;MARD&nbsp;에서&nbsp;필요&nbsp;원자재&nbsp;재고&nbsp;현황&nbsp;읽어옴<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;get_mard_data&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_range&nbsp;TYPE&nbsp;RANGE&nbsp;OF&nbsp;zcb_matnr,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_range&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_range.<br />
*<br />
*&nbsp;&nbsp;&nbsp;"&nbsp;gt_schedule&nbsp;안의&nbsp;matnr&nbsp;값으로&nbsp;range&nbsp;조건&nbsp;생성<br />
*&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;lt_range.<br />
*<br />
*&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule&nbsp;INTO&nbsp;DATA(ls_mard_check).<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_mard_check-matnr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_range.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_range-sign&nbsp;=&nbsp;'I'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_range-option&nbsp;=&nbsp;'EQ'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_range-low&nbsp;=&nbsp;ls_mard_check-matnr.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_range&nbsp;TO&nbsp;lt_range.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~matnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~werks,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~lgort,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~lfgja,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~labst,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~lobst,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~salk3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~lvorm,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b~maktx<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@gt_mard<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_mard&nbsp;AS&nbsp;a<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;zcb_makt&nbsp;AS&nbsp;b<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;b~matnr&nbsp;=&nbsp;a~matnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;b~spras&nbsp;=&nbsp;@sy-langu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~matnr&nbsp;IN&nbsp;@lt_range<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;werks&nbsp;=&nbsp;@pa_werks.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;이의정&nbsp;join&nbsp;에&nbsp;저장고를&nbsp;marc&nbsp;기준으로<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ZCB_MARD&nbsp;DB를&nbsp;가져오는데&nbsp;오류발생<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e400(zcb_msg)&nbsp;WITH&nbsp;'ZCB_MARD'.<br />
&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_mard&nbsp;BY&nbsp;matnr.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;스케줄&nbsp;기반으로&nbsp;공정&nbsp;자재&nbsp;+&nbsp;재고&nbsp;현황&nbsp;구성<br />
&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;gt_mard_sched,&nbsp;gt_mard_sched_finish.<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule&nbsp;INTO&nbsp;DATA(ls_sched).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산&nbsp;재료&nbsp;TAB&nbsp;세팅<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_mard&nbsp;INTO&nbsp;DATA(ls_mard)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;matnr&nbsp;=&nbsp;ls_sched-matnr&nbsp;werks&nbsp;=&nbsp;pa_werks.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_mard_sched&nbsp;INTO&nbsp;DATA(ls_mard_sched)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;matnr&nbsp;=&nbsp;ls_mard-matnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;만약&nbsp;최초로&nbsp;추가되는거면<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched-maktx&nbsp;=&nbsp;ls_mard-maktx.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched-menge&nbsp;=&nbsp;ls_mard-labst.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched-matnr&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_sched-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched-quantity&nbsp;=&nbsp;ls_sched-menge.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched-meins&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_sched-meins.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_mard_sched&nbsp;TO&nbsp;gt_mard_sched.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;만약&nbsp;TAB에&nbsp;값이&nbsp;존재함면<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched-quantity&nbsp;+=&nbsp;ls_sched-menge.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_mard_sched&nbsp;FROM&nbsp;ls_mard_sched&nbsp;TRANSPORTING&nbsp;quantity&nbsp;WHERE&nbsp;matnr&nbsp;=&nbsp;ls_mard_sched-matnr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;완재품&nbsp;TAB&nbsp;세팅<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_mard&nbsp;INTO&nbsp;DATA(ls_mard_finish)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;matnr&nbsp;=&nbsp;ls_sched-product&nbsp;werks&nbsp;=&nbsp;pa_werks.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_mard_sched_finish&nbsp;INTO&nbsp;DATA(ls_mard_sched_finish)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;matnr&nbsp;=&nbsp;ls_mard_finish-matnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;만약&nbsp;최초로&nbsp;추가되는거면<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched_finish-maktx&nbsp;=&nbsp;ls_mard_finish-maktx.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched_finish-menge&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched_finish-matnr&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_mard_finish-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched_finish-quantity&nbsp;=&nbsp;ls_sched-quantity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched_finish-meins&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_sched-unit.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_mard_sched_finish&nbsp;TO&nbsp;gt_mard_sched_finish.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;만약&nbsp;TAB에&nbsp;값이&nbsp;존재함면<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_mard_sched_finish-quantity&nbsp;+=&nbsp;ls_sched-menge.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_mard_sched_finish&nbsp;FROM&nbsp;ls_mard_sched_finish&nbsp;TRANSPORTING&nbsp;quantity&nbsp;WHERE&nbsp;matnr&nbsp;=&nbsp;ls_mard_finish-matnr&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_grid3_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SET&nbsp;SBUA&nbsp;1&nbsp;-&nbsp;1&nbsp;LAYO&nbsp;FCAT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_grid3_0100.<br />
&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_layo3,&nbsp;gs_variant3&nbsp;,&nbsp;gt_fcat3.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_variant3-report&nbsp;=&nbsp;sy-cprog.<br />
&nbsp;&nbsp;&nbsp;gs_variant3-handle&nbsp;=&nbsp;'GRID3'.<br />
<br />
&nbsp;&nbsp;&nbsp;gv_save3&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_layo3-sel_mode&nbsp;=&nbsp;'B'.&nbsp;"&nbsp;CELL&nbsp;단위&nbsp;선택가능<br />
&nbsp;&nbsp;&nbsp;gs_layo3-zebra&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;얼룩처리<br />
&nbsp;&nbsp;&nbsp;gs_layo3-ctab_fname&nbsp;=&nbsp;'ROWCOLOR'.&nbsp;"&nbsp;cell&nbsp;색&nbsp;넣기<br />
&nbsp;&nbsp;&nbsp;gs_layo3-info_fname&nbsp;=&nbsp;'COLOR'.&nbsp;"&nbsp;ROW&nbsp;색<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;gs_layo3-grid_title&nbsp;=&nbsp;'생산&nbsp;요청'.<br />
*&nbsp;&nbsp;gs_layo1-stylefname&nbsp;=&nbsp;'CELLTAB'.<br />
*&nbsp;&nbsp;gs_layo3-cwidth_opt&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;열넓이&nbsp;최적화&nbsp;샐&nbsp;넓이가&nbsp;고정이&nbsp;되어버림&nbsp;최적으로<br />
*&nbsp;&nbsp;gs_layo1-edit&nbsp;=&nbsp;''.&nbsp;"&nbsp;수정모드&nbsp;전체&nbsp;필드가&nbsp;수정&nbsp;가능하게&nbsp;되어짐<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;미사용&nbsp;필드<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
*&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'APPROV_T'.<br />
*&nbsp;&nbsp;gs_fcat1-no_out&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;사용할&nbsp;필드<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-fieldname&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-coltext&nbsp;=&nbsp;'자재번호'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat3&nbsp;TO&nbsp;gt_fcat3.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-fieldname&nbsp;=&nbsp;'MAKTX'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-coltext&nbsp;=&nbsp;'자재설명'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-outputlen&nbsp;&nbsp;=&nbsp;16.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-emphasize&nbsp;=&nbsp;'C110'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat3&nbsp;TO&nbsp;gt_fcat3.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-fieldname&nbsp;=&nbsp;'quantity'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-coltext&nbsp;=&nbsp;'필요수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat3&nbsp;TO&nbsp;gt_fcat3.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-fieldname&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-coltext&nbsp;=&nbsp;'재고수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat3&nbsp;TO&nbsp;gt_fcat3.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-fieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-coltext&nbsp;=&nbsp;'단위'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat3-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat3&nbsp;TO&nbsp;gt_fcat3.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_grid4_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SET&nbsp;SBUA&nbsp;1&nbsp;-&nbsp;2&nbsp;LAYO&nbsp;FCAT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_grid4_0100.<br />
&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_layo4,&nbsp;gs_variant4&nbsp;,&nbsp;gt_fcat4.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_variant4-report&nbsp;=&nbsp;sy-cprog.<br />
&nbsp;&nbsp;&nbsp;gs_variant4-handle&nbsp;=&nbsp;'GRID4'.<br />
<br />
&nbsp;&nbsp;&nbsp;gv_save4&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_layo4-sel_mode&nbsp;=&nbsp;'B'.&nbsp;"&nbsp;CELL&nbsp;단위&nbsp;선택가능<br />
&nbsp;&nbsp;&nbsp;gs_layo4-zebra&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;얼룩처리<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;gs_layo3-grid_title&nbsp;=&nbsp;'생산&nbsp;요청'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;gs_layo4-ctab_fname&nbsp;=&nbsp;'ROWCOLOR'.&nbsp;"&nbsp;cell&nbsp;색&nbsp;넣기<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;gs_layo3-cwidth_opt&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;열넓이&nbsp;최적화&nbsp;샐&nbsp;넓이가&nbsp;고정이&nbsp;되어버림&nbsp;최적으로<br />
*&nbsp;&nbsp;gs_layo1-edit&nbsp;=&nbsp;''.&nbsp;"&nbsp;수정모드&nbsp;전체&nbsp;필드가&nbsp;수정&nbsp;가능하게&nbsp;되어짐<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;미사용&nbsp;필드<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
*&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'APPROV_T'.<br />
*&nbsp;&nbsp;gs_fcat1-no_out&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;사용할&nbsp;필드<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat4.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-fieldname&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-coltext&nbsp;=&nbsp;'자재번호'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat4&nbsp;TO&nbsp;gt_fcat4.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat4.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-fieldname&nbsp;=&nbsp;'MAKTX'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-coltext&nbsp;=&nbsp;'자재설명'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-outputlen&nbsp;&nbsp;=&nbsp;16.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-emphasize&nbsp;=&nbsp;'C110'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat4&nbsp;TO&nbsp;gt_fcat4.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat4.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-fieldname&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-coltext&nbsp;=&nbsp;'생산&nbsp;수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat4&nbsp;TO&nbsp;gt_fcat4.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat4.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-fieldname&nbsp;=&nbsp;'quantity'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-coltext&nbsp;=&nbsp;'생산&nbsp;계획&nbsp;수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat4&nbsp;TO&nbsp;gt_fcat4.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat4.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-fieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-coltext&nbsp;=&nbsp;'단위'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat4-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat4&nbsp;TO&nbsp;gt_fcat4.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_grid5_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SET&nbsp;SBUA&nbsp;2&nbsp;-&nbsp;1&nbsp;LAYO&nbsp;FCAT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_grid5_0100.<br />
&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_layo5,&nbsp;gs_variant5&nbsp;,&nbsp;gt_fcat5.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_variant4-report&nbsp;=&nbsp;sy-cprog.<br />
&nbsp;&nbsp;&nbsp;gs_variant4-handle&nbsp;=&nbsp;'GRID5'.<br />
<br />
&nbsp;&nbsp;&nbsp;gv_save5&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_layo5-sel_mode&nbsp;=&nbsp;'B'.&nbsp;"&nbsp;CELL&nbsp;단위&nbsp;선택가능<br />
&nbsp;&nbsp;&nbsp;gs_layo5-zebra&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;얼룩처리<br />
&nbsp;&nbsp;&nbsp;gs_layo5-info_fname&nbsp;=&nbsp;'COLOR'.&nbsp;"&nbsp;ROW&nbsp;색<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;gs_layo3-grid_title&nbsp;=&nbsp;'생산&nbsp;요청'.<br />
*&nbsp;&nbsp;gs_layo1-stylefname&nbsp;=&nbsp;'CELLTAB'.<br />
*&nbsp;&nbsp;gs_layo3-cwidth_opt&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;열넓이&nbsp;최적화&nbsp;샐&nbsp;넓이가&nbsp;고정이&nbsp;되어버림&nbsp;최적으로<br />
*&nbsp;&nbsp;gs_layo1-edit&nbsp;=&nbsp;''.&nbsp;"&nbsp;수정모드&nbsp;전체&nbsp;필드가&nbsp;수정&nbsp;가능하게&nbsp;되어짐<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;미사용&nbsp;필드<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
*&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'APPROV_T'.<br />
*&nbsp;&nbsp;gs_fcat1-no_out&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
*&nbsp;&nbsp;&nbsp;tick&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;i,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;진행틱<br />
*&nbsp;&nbsp;&nbsp;aufnr&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_aufnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산오더<br />
*&nbsp;&nbsp;&nbsp;posnr&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_posnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;AFPO&nbsp;행번호<br />
*&nbsp;&nbsp;&nbsp;plnkn&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_PLNKN,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정순서<br />
*&nbsp;&nbsp;&nbsp;arbpl&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_arbpl,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;할당&nbsp;작업장<br />
*&nbsp;&nbsp;&nbsp;matnr&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_matnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;원재료<br />
*&nbsp;&nbsp;&nbsp;menge&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_wemng,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;투입수량<br />
*&nbsp;&nbsp;&nbsp;meins&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_meins,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;단위<br />
*&nbsp;&nbsp;&nbsp;product&nbsp;&nbsp;TYPE&nbsp;zcb_matnr,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산자재<br />
*&nbsp;&nbsp;&nbsp;quantity&nbsp;TYPE&nbsp;zcb_wemng,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산수량<br />
*&nbsp;&nbsp;&nbsp;unit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zcb_meins,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;단위<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;사용할&nbsp;필드<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat5.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-fieldname&nbsp;=&nbsp;'tick'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-coltext&nbsp;=&nbsp;'No.'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-outputlen&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat5&nbsp;TO&nbsp;gt_fcat5.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat5.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-fieldname&nbsp;=&nbsp;'AUFNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-coltext&nbsp;=&nbsp;'생산오더'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-outputlen&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-ref_field&nbsp;=&nbsp;'AUFNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat5&nbsp;TO&nbsp;gt_fcat5.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat5.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-fieldname&nbsp;=&nbsp;'POSNR'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-coltext&nbsp;=&nbsp;'순번'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-ref_table&nbsp;=&nbsp;'ZCB_AFPO'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-ref_field&nbsp;=&nbsp;'POSNR'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
*&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat5&nbsp;TO&nbsp;gt_fcat5.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat5.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-fieldname&nbsp;=&nbsp;'ARBPL'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-coltext&nbsp;=&nbsp;'작업장'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-outputlen&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-ref_table&nbsp;=&nbsp;'ZCB_AFPO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-ref_field&nbsp;=&nbsp;'ARBPL'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat5&nbsp;TO&nbsp;gt_fcat5.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat5.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-fieldname&nbsp;=&nbsp;'PLNKN'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-coltext&nbsp;=&nbsp;'공정단계'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-outputlen&nbsp;&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-ref_table&nbsp;=&nbsp;'ZCB_AFPO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-ref_field&nbsp;=&nbsp;'PLNKN'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat5&nbsp;TO&nbsp;gt_fcat5.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat5.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-fieldname&nbsp;=&nbsp;'LTXA1'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-coltext&nbsp;=&nbsp;'공정&nbsp;설명'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-outputlen&nbsp;&nbsp;=&nbsp;20.<br />
&nbsp;&nbsp;&nbsp;gs_fcat5-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat5&nbsp;TO&nbsp;gt_fcat5.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat5.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-fieldname&nbsp;=&nbsp;'LTXA2'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-coltext&nbsp;=&nbsp;'비고'.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-outputlen&nbsp;&nbsp;=&nbsp;25.<br />
*&nbsp;&nbsp;&nbsp;gs_fcat5-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
*&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat5&nbsp;TO&nbsp;gt_fcat5.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;all_alv_refresh<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;모든&nbsp;ALV&nbsp;새로고침<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;all_alv_refresh&nbsp;.<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;alv_refresh_0100&nbsp;USING&nbsp;go_alv_grid1.<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;alv_refresh_0100&nbsp;USING&nbsp;go_alv_grid2.<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;alv_refresh_0100&nbsp;USING&nbsp;go_alv_grid3.<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;alv_refresh_0100&nbsp;USING&nbsp;go_alv_grid4.<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;alv_refresh_0100&nbsp;USING&nbsp;go_alv_grid5.<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;color_grid5<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;GRID5&nbsp;공정&nbsp;스캐쥴링&nbsp;에&nbsp;해당하는&nbsp;TICK&nbsp;의&nbsp;ROW&nbsp;에&nbsp;색을&nbsp;넣음.<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;color_grid5&nbsp;.<br />
   </div>
   <div class="codeComment">
*&nbsp;gt_schedule_tick&nbsp;TAB에&nbsp;현재&nbsp;진행된&nbsp;TICK&nbsp;에&nbsp;색을&nbsp;넣음<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_tick&nbsp;INTO&nbsp;DATA(ls_tick).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_tick-tick&nbsp;=&nbsp;gv_process_status.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_tick-color&nbsp;=&nbsp;gc_color_yellow1.&nbsp;"&nbsp;노랑<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정&nbsp;단계&nbsp;-&gt;&nbsp;대쉬보드에&nbsp;기록<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_tick-color&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_schedule_tick&nbsp;FROM&nbsp;ls_tick.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_product_log<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;ALV&nbsp;GRID2&nbsp;공정&nbsp;LOG&nbsp;출력<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_product_log&nbsp;.<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule&nbsp;INTO&nbsp;DATA(ls_sched)&nbsp;&nbsp;WHERE&nbsp;tick&nbsp;=&nbsp;gv_process_status.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_sched&nbsp;TO&nbsp;gt_schedule_log.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;공정&nbsp;LOG&nbsp;row&nbsp;에&nbsp;색<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;color_grid2.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;생산&nbsp;스캐쥴&nbsp;row에&nbsp;색<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;color_grid5.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;회계문서&nbsp;생성&nbsp;및&nbsp;자재문서&nbsp;생성<br />
&nbsp;&nbsp;&nbsp;"&nbsp;이의정&nbsp;태스트&nbsp;삼아&nbsp;끔<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;get_transcation.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;color_grid2<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;GRID2&nbsp;공정&nbsp;LOG에&nbsp;해당하는&nbsp;TICK&nbsp;의&nbsp;ROW&nbsp;에&nbsp;색을&nbsp;넣음.<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;color_grid2&nbsp;.<br />
&nbsp;&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;fs_afko&gt;&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;gt_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_log&nbsp;INTO&nbsp;DATA(ls_log).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;where&nbsp;쓰고&nbsp;싶은데&nbsp;아닌경우&nbsp;색&nbsp;해채&nbsp;해야해서&nbsp;그냥&nbsp;조건문씀<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_log-tick&nbsp;=&nbsp;gv_process_status.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;일반&nbsp;공정&nbsp;진행<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_log-color&nbsp;=&nbsp;gc_color_yellow1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_log-ltxa2&nbsp;CP&nbsp;'*생산시작*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_log-color&nbsp;=&nbsp;gc_color_blue1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;ls_log-ltxa2&nbsp;CP&nbsp;'*생산완료*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_log-color&nbsp;=&nbsp;gc_color_green1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산오더&nbsp;현황에&nbsp;공정&nbsp;진행률&nbsp;업데이트<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afko&nbsp;ASSIGNING&nbsp;&lt;fs_afko&gt;&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_log-aufnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_afko&gt;-porder&nbsp;=&nbsp;ls_log-plnkn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_afko&gt;-pratio&nbsp;=&nbsp;(&nbsp;&lt;fs_afko&gt;-porder&nbsp;/&nbsp;&lt;fs_afko&gt;-polast&nbsp;)&nbsp;*&nbsp;100.&nbsp;"&nbsp;이&nbsp;필드만&nbsp;직접&nbsp;수정<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;fs_afko&gt;-porder&nbsp;=&nbsp;&lt;fs_afko&gt;-polast.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산&nbsp;공정이&nbsp;최종&nbsp;단계&nbsp;까지&nbsp;가면&nbsp;생산&nbsp;완료&nbsp;아이콘<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_afko&gt;-icon&nbsp;=&nbsp;icon_led_green.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;실제&nbsp;생산&nbsp;종료일&nbsp;입력<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_afko&gt;-gltri&nbsp;=&nbsp;sy-datum.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;실제&nbsp;실적&nbsp;가&nbsp;입력<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_afko&gt;-gsamng&nbsp;=&nbsp;&lt;fs_afko&gt;-gamng.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산&nbsp;공정이&nbsp;실행에&nbsp;들어가면&nbsp;생산중&nbsp;아이콘<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fs_afko&gt;-icon&nbsp;=&nbsp;icon_led_yellow.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_log-color&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_schedule_log&nbsp;FROM&nbsp;ls_log.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;color_gird4<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;GRID4&nbsp;완제품&nbsp;현황에&nbsp;제품이&nbsp;생산이&nbsp;되면&nbsp;수량이&nbsp;깍이고&nbsp;깜빡임&nbsp;CELL<br />
*&&nbsp;생산완료&nbsp;필드에&nbsp;생산&nbsp;수량&nbsp;채움<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;color_gird4&nbsp;.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_sum&nbsp;&nbsp;TYPE&nbsp;zcb_wemng,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol&nbsp;TYPE&nbsp;lvc_s_scol.<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_mard_sched_finish&nbsp;INTO&nbsp;DATA(ls_finish).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_sum,&nbsp;ls_finish-rowcolor.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_log&nbsp;INTO&nbsp;DATA(ls_log)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;tick&nbsp;=&nbsp;gv_process_status<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;product&nbsp;=&nbsp;ls_finish-matnr&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_sum&nbsp;=&nbsp;lv_sum&nbsp;+&nbsp;ls_log-quantity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.&nbsp;"<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_log-quantity&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;누적&nbsp;생산&nbsp;수량&nbsp;반영<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_finish-menge&nbsp;=&nbsp;ls_finish-menge&nbsp;+&nbsp;lv_sum.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;MENGE&nbsp;셀에&nbsp;초록색&nbsp;강조&nbsp;스타일&nbsp;적용<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-fname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-col&nbsp;&nbsp;&nbsp;=&nbsp;col_positive.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-int&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-inv&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_scol&nbsp;TO&nbsp;ls_finish-rowcolor.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;셀&nbsp;색상&nbsp;설정&nbsp;(없으면&nbsp;초기화)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_mard_sched_finish&nbsp;FROM&nbsp;ls_finish.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;초기화&nbsp;안하면&nbsp;계속&nbsp;색이&nbsp;남아&nbsp;있음<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_log.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_matnr_log<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;생산&nbsp;제품&nbsp;및&nbsp;자재&nbsp;소모<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_matnr_log&nbsp;.<br />
&nbsp;&nbsp;&nbsp;"&nbsp;생산&nbsp;제품&nbsp;에&nbsp;색&nbsp;반영<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;color_gird4.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;소비&nbsp;자재에&nbsp;색&nbsp;반영<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;color_grid3.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;color_grid3<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;GRID3&nbsp;자재&nbsp;소비에&nbsp;색&nbsp;반영&nbsp;및&nbsp;소비&nbsp;자재&nbsp;감소<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;color_grid3&nbsp;.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_sum&nbsp;&nbsp;TYPE&nbsp;zcb_wemng,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol&nbsp;TYPE&nbsp;lvc_s_scol.<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_mard_sched&nbsp;INTO&nbsp;DATA(ls_finish).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_sum,&nbsp;ls_finish-rowcolor.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_log&nbsp;INTO&nbsp;DATA(ls_log)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;tick&nbsp;=&nbsp;gv_process_status<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;matnr&nbsp;=&nbsp;ls_finish-matnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_sum&nbsp;=&nbsp;lv_sum&nbsp;+&nbsp;ls_log-menge.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_log-menge&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;누적&nbsp;소모&nbsp;수량&nbsp;반영<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_finish-menge&nbsp;=&nbsp;ls_finish-menge&nbsp;-&nbsp;lv_sum.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;MENGE&nbsp;셀에&nbsp;초록색&nbsp;강조&nbsp;스타일&nbsp;적용<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-fname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-col&nbsp;&nbsp;&nbsp;=&nbsp;col_negative.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-int&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-inv&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_scol&nbsp;TO&nbsp;ls_finish-rowcolor.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;셀&nbsp;색상&nbsp;설정&nbsp;(없으면&nbsp;초기화)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_mard_sched&nbsp;FROM&nbsp;ls_finish.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;초기화&nbsp;안하면&nbsp;계속&nbsp;색이&nbsp;남아&nbsp;있음<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_log.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;check_storage_for_production<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;생산을&nbsp;위한&nbsp;재고량&nbsp;비교<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;check_storage_for_production&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_celltab&nbsp;TYPE&nbsp;lvc_t_styl,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_cell&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;lvc_s_styl,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;lvc_s_scol.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;DATA(lv_check_short)&nbsp;=&nbsp;0.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_mard_sched&nbsp;INTO&nbsp;DATA(ls_mard).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;lt_celltab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;ls_cell,&nbsp;gs_mard_eban.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_mard&nbsp;TO&nbsp;gs_mard_eban.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gs_mard_eban-menge&nbsp;&gt;=&nbsp;gs_mard_eban-quantity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_mard_eban-color&nbsp;=&nbsp;gc_color_green1.&nbsp;&nbsp;"&nbsp;수량&nbsp;충분&nbsp;→&nbsp;초록<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_mard_eban-quantity2&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;입력필드&nbsp;끄기<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;ls_cell.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_cell-style&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_style_disabled.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_cell-fieldname&nbsp;=&nbsp;'QUANTITY2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_cell&nbsp;TO&nbsp;lt_celltab.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_mard_eban-color&nbsp;=&nbsp;gc_color_red1.&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;부족&nbsp;→&nbsp;빨강<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_mard_eban-quantity2&nbsp;=&nbsp;gs_mard_eban-quantity&nbsp;-&nbsp;gs_mard_eban-menge.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_check_short&nbsp;+=&nbsp;1&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;자재가&nbsp;부족할시&nbsp;부족분&nbsp;샐&nbsp;값&nbsp;수정&nbsp;가능<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;ls_cell.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_cell-style&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_style_enabled.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_cell-fieldname&nbsp;=&nbsp;'QUANTITY2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_cell&nbsp;TO&nbsp;lt_celltab.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;MENGE&nbsp;셀에&nbsp;파랑색&nbsp;&nbsp;스타일&nbsp;적용&nbsp;??&nbsp;적용되려나<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-fname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'QUANTITY2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-col&nbsp;&nbsp;&nbsp;=&nbsp;col_positive.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-int&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_scol-color-inv&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_scol&nbsp;TO&nbsp;gs_mard_eban-rowcolor.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_mard_eban-celltab&nbsp;=&nbsp;lt_celltab.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_mard_eban&nbsp;TO&nbsp;gt_mard_eban&nbsp;.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;lv_check_short&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_flag_mard&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_flag_mard&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;purchase_request<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;부족&nbsp;자재&nbsp;구매요청&nbsp;수행<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;purchase_request&nbsp;.<br />
&nbsp;&nbsp;&nbsp;"&nbsp;PP090&nbsp;구매요청&nbsp;프로그램의&nbsp;넘겨&nbsp;받는&nbsp;양식<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_eban&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_pp_eabn.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_eban&nbsp;TYPE&nbsp;zcb_pp_eabn.<br />
&nbsp;&nbsp;&nbsp;"&nbsp;생산요청&nbsp;ITAB<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_afko&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_pp_afko.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_afko&nbsp;TYPE&nbsp;zcb_pp_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;자재별&nbsp;저장위치<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_marc&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_marc,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_marc&nbsp;TYPE&nbsp;zcb_marc.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;역&nbsp;Bom&nbsp;원재료&nbsp;닭&nbsp;갯수를&nbsp;구하기&nbsp;위한&nbsp;ITAB<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_stpo&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_stpo.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_stpo&nbsp;TYPE&nbsp;zcb_stpo.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgpro<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_marc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@lt_marc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;werks&nbsp;=&nbsp;@pa_werks.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e400(zcb_msg)&nbsp;WITH&nbsp;'ZCB_MARC'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idnrk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menge,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meins<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zcb_stpo<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@lt_stpo<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;stlnr&nbsp;=&nbsp;'B0001'.&nbsp;"&nbsp;역&nbsp;BOM&nbsp;은&nbsp;개만&nbsp;사용&nbsp;함.&nbsp;"&nbsp;시간나면&nbsp;리팩토링시&nbsp;서브루틴&nbsp;2개로&nbsp;합쳐야&nbsp;사용가능&nbsp;동적&nbsp;처리는<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e400(zcb_msg)&nbsp;WITH&nbsp;'ZCB_STPO'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_mard_eban&nbsp;INTO&nbsp;DATA(ls_mard).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;역&nbsp;BOM&nbsp;일&nbsp;경우<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;ls_mard-quantity2&nbsp;&gt;&nbsp;0&nbsp;AND&nbsp;ls_mard-matnr&nbsp;CP&nbsp;'WP*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_stpo&nbsp;INTO&nbsp;DATA(ls_stpo)&nbsp;WITH&nbsp;KEY&nbsp;idnrk&nbsp;=&nbsp;ls_mard-matnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_eban&nbsp;INTO&nbsp;DATA(ls_eban2)&nbsp;WITH&nbsp;KEY&nbsp;matnr&nbsp;=&nbsp;'RM102'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;이전에&nbsp;기록된&nbsp;값이&nbsp;없으면.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;구매요청<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-werks&nbsp;=&nbsp;pa_werks.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-matnr&nbsp;=&nbsp;'RM102'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-menge&nbsp;=&nbsp;ceil(&nbsp;ls_mard-quantity2&nbsp;/&nbsp;ls_stpo-menge&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-meins&nbsp;=&nbsp;ls_stpo-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-eindt&nbsp;=&nbsp;sy-datum.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_marc&nbsp;INTO&nbsp;ls_marc&nbsp;WITH&nbsp;KEY&nbsp;matnr&nbsp;=&nbsp;ls_eban-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-lgort&nbsp;=&nbsp;ls_marc-lgpro.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_eban&nbsp;TO&nbsp;lt_eban.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산요청&nbsp;-&nbsp;예는&nbsp;한줄만&nbsp;있으면되서&nbsp;구조체로만&nbsp;가져감.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-werks&nbsp;=&nbsp;pa_werks.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-plnbez&nbsp;=&nbsp;'RM102'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-gamng&nbsp;=&nbsp;ceil(&nbsp;ls_mard-quantity2&nbsp;/&nbsp;ls_stpo-menge&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-meins&nbsp;=&nbsp;ls_stpo-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-gltrs&nbsp;=&nbsp;sy-datum.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ceil(&nbsp;ls_mard-quantity2&nbsp;/&nbsp;ls_stpo-menge&nbsp;)&nbsp;&gt;&nbsp;ls_eban2-menge.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban2-menge&nbsp;=&nbsp;ceil(&nbsp;ls_mard-quantity2&nbsp;/&nbsp;ls_stpo-menge&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;lt_eban&nbsp;FROM&nbsp;ls_eban2&nbsp;TRANSPORTING&nbsp;menge.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산요청&nbsp;-&nbsp;예는&nbsp;한줄만&nbsp;있으면되서&nbsp;구조체로만&nbsp;가져감.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko-gamng&nbsp;=&nbsp;ceil(&nbsp;ls_mard-quantity2&nbsp;/&nbsp;ls_stpo-menge&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;일반&nbsp;자재일&nbsp;경우<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;ls_mard-quantity2&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-werks&nbsp;=&nbsp;pa_werks.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-matnr&nbsp;=&nbsp;ls_mard-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-menge&nbsp;=&nbsp;ls_mard-quantity2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-meins&nbsp;=&nbsp;ls_mard-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-eindt&nbsp;=&nbsp;sy-datum.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_marc&nbsp;INTO&nbsp;ls_marc&nbsp;WITH&nbsp;KEY&nbsp;matnr&nbsp;=&nbsp;ls_mard-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_eban-lgort&nbsp;=&nbsp;ls_marc-lgpro.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_eban&nbsp;TO&nbsp;lt_eban.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;생산요청&nbsp;append<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_afko&nbsp;TO&nbsp;lt_afko.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;구매&nbsp;및&nbsp;생산&nbsp;요청을&nbsp;위해&nbsp;Table&nbsp;을&nbsp;SAP&nbsp;Memory&nbsp;로&nbsp;전달<br />
&nbsp;&nbsp;&nbsp;EXPORT&nbsp;lt_eban&nbsp;lt_afko<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'ZPP070'.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;ZBC_PP090&nbsp;구매&nbsp;및&nbsp;생산요청&nbsp;프로그램으로&nbsp;이동<br />
&nbsp;&nbsp;&nbsp;SUBMIT&nbsp;zcb_pp090.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_grid7_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;SCR&nbsp;200&nbsp;부족&nbsp;자재&nbsp;비교화면<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_grid7_0100&nbsp;.<br />
&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_layo7,&nbsp;gs_variant7&nbsp;,&nbsp;gt_fcat7.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_variant7-report&nbsp;=&nbsp;sy-cprog.<br />
&nbsp;&nbsp;&nbsp;gs_variant7-handle&nbsp;=&nbsp;'GRID7'.<br />
<br />
&nbsp;&nbsp;&nbsp;gv_save7&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_layo7-sel_mode&nbsp;=&nbsp;'B'.&nbsp;"&nbsp;CELL&nbsp;단위&nbsp;선택가능<br />
&nbsp;&nbsp;&nbsp;gs_layo7-zebra&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;얼룩처리<br />
&nbsp;&nbsp;&nbsp;gs_layo7-ctab_fname&nbsp;=&nbsp;'ROWCOLOR'.&nbsp;"&nbsp;cell&nbsp;색&nbsp;넣기<br />
&nbsp;&nbsp;&nbsp;gs_layo7-info_fname&nbsp;=&nbsp;'COLOR'.&nbsp;"&nbsp;ROW&nbsp;색<br />
&nbsp;&nbsp;&nbsp;gs_layo7-grid_title&nbsp;=&nbsp;'부족자재&nbsp;요청'.<br />
&nbsp;&nbsp;&nbsp;gs_layo7-stylefname&nbsp;=&nbsp;'CELLTAB'.<br />
&nbsp;&nbsp;&nbsp;gs_layo7-no_toolbar&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;gs_layo3-cwidth_opt&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;열넓이&nbsp;최적화&nbsp;샐&nbsp;넓이가&nbsp;고정이&nbsp;되어버림&nbsp;최적으로<br />
*&nbsp;&nbsp;gs_layo1-edit&nbsp;=&nbsp;''.&nbsp;"&nbsp;수정모드&nbsp;전체&nbsp;필드가&nbsp;수정&nbsp;가능하게&nbsp;되어짐<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;미사용&nbsp;필드<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
*&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'APPROV_T'.<br />
*&nbsp;&nbsp;gs_fcat1-no_out&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;사용할&nbsp;필드<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat7.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-fieldname&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-coltext&nbsp;=&nbsp;'자재번호'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat7&nbsp;TO&nbsp;gt_fcat7.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat7.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-fieldname&nbsp;=&nbsp;'MAKTX'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-coltext&nbsp;=&nbsp;'자재설명'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-outputlen&nbsp;&nbsp;=&nbsp;16.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-emphasize&nbsp;=&nbsp;'C110'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat7&nbsp;TO&nbsp;gt_fcat7.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat7.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-fieldname&nbsp;=&nbsp;'QUANTITY'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-coltext&nbsp;=&nbsp;'필요수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat7&nbsp;TO&nbsp;gt_fcat7.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat7.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-fieldname&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-coltext&nbsp;=&nbsp;'재고수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat7&nbsp;TO&nbsp;gt_fcat7.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat7.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-fieldname&nbsp;=&nbsp;'QUANTITY2'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-coltext&nbsp;=&nbsp;'구매요청수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-outputlen&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-edit&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat7&nbsp;TO&nbsp;gt_fcat7.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat7.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-fieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-coltext&nbsp;=&nbsp;'단위'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat7-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat7&nbsp;TO&nbsp;gt_fcat7.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;get_transcation<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;생산자재&nbsp;투입시,&nbsp;회계문서&nbsp;&&nbsp;자재&nbsp;문서&nbsp;생성<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;get_transcation&nbsp;.<br />
&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;전송을&nbsp;위한&nbsp;ITAB<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_bdc_pri&nbsp;TYPE&nbsp;zcb_bom_item.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_bdc_pri&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_bdc_pri.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;회계문서&nbsp;발행을&nbsp;위한&nbsp;ITAB<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_fi&nbsp;TYPE&nbsp;zcb_fi_plnnr.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_fi&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_fi.<br />
<br />
&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;lt_bdc_pri,&nbsp;lt_fi.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;이번틱에&nbsp;작동하는&nbsp;생산오더&nbsp;저장<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_aufnr&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_afko-aufnr.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;현재&nbsp;틱에&nbsp;작동하는&nbsp;오더&nbsp;가져옴<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_log&nbsp;INTO&nbsp;DATA(ls_log)&nbsp;WHERE&nbsp;tick&nbsp;=&nbsp;gv_process_status.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;중복&nbsp;체크<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_aufnr&nbsp;WITH&nbsp;KEY&nbsp;=&nbsp;ls_log-aufnr&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_log-aufnr&nbsp;TO&nbsp;lt_aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;와&nbsp;회계&nbsp;문서에&nbsp;사용할&nbsp;ITAB&nbsp;가공<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_aufnr&nbsp;INTO&nbsp;DATA(lv_aufnr).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;lt_fi,&nbsp;lt_bdc_pri.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_log&nbsp;INTO&nbsp;DATA(ls_log2)&nbsp;WHERE&nbsp;tick&nbsp;=&nbsp;gv_process_status&nbsp;AND&nbsp;aufnr&nbsp;=&nbsp;lv_aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_log2-matnr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-idnrk&nbsp;=&nbsp;ls_log2-matnr.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afko&nbsp;INTO&nbsp;DATA(ls_afko)&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;lv_aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-stlnr&nbsp;=&nbsp;ls_afko-stlnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_log2-matnr&nbsp;CP&nbsp;'RM1*'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-lgort&nbsp;=&nbsp;ls_afko-lgort.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afpo&nbsp;INTO&nbsp;DATA(ls_afpo)&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;lv_aufnr&nbsp;matnr&nbsp;=&nbsp;ls_log2-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-lgort&nbsp;=&nbsp;ls_afpo-lgort.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-meins&nbsp;=&nbsp;ls_log2-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-menge&nbsp;=&nbsp;ls_log2-menge.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-werks&nbsp;=&nbsp;pa_werks.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_bdc_pri&nbsp;TO&nbsp;lt_bdc_pri.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fi-matnr&nbsp;=&nbsp;ls_log2-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fi-meins&nbsp;=&nbsp;ls_log2-meins.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fi-menge&nbsp;=&nbsp;ls_log2-menge.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fi-plnkn&nbsp;=&nbsp;ls_log2-plnkn.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_fi&nbsp;TO&nbsp;lt_fi.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;로&nbsp;넘길&nbsp;데이터가&nbsp;있는&nbsp;경우<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lt_bdc_pri&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;자재문서&nbsp;발행을&nbsp;위한&nbsp;ITAB&nbsp;전달<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORT&nbsp;input_material&nbsp;=&nbsp;lt_bdc_pri&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'ABAP_ZCB_MEMORY'.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"BDC&nbsp;실행<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"----------<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_bdc&nbsp;TYPE&nbsp;bdcdata.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;단일&nbsp;레코드&nbsp;작업&nbsp;영역<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_opt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ctu_params.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;CALL&nbsp;TRANSACTION&nbsp;옵션&nbsp;구조<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_msg&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;bdcmsgcoll,&nbsp;"&nbsp;BDC&nbsp;수행&nbsp;후&nbsp;메시지&nbsp;테이블<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_msg&nbsp;TYPE&nbsp;bdcmsgcoll.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;메시지&nbsp;단일&nbsp;레코드&nbsp;작업&nbsp;영역<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_message&nbsp;TYPE&nbsp;string.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;메시지&nbsp;텍스트를&nbsp;담을&nbsp;변수<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gt_bdc[],&nbsp;ls_bdc,&nbsp;ls_opt,&nbsp;lt_msg,&nbsp;ls_msg,&nbsp;lv_message.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_opt-dismode&nbsp;=&nbsp;'E'.&nbsp;&nbsp;&nbsp;"&nbsp;E:&nbsp;오류&nbsp;발생&nbsp;시&nbsp;화면&nbsp;표시&nbsp;,&nbsp;N&nbsp;:&nbsp;화면&nbsp;표시&nbsp;없음.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_opt-updmode&nbsp;=&nbsp;'A'.&nbsp;&nbsp;&nbsp;"&nbsp;A:&nbsp;비동기&nbsp;업데이트<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_opt-defsize&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;"&nbsp;기본&nbsp;윈도우&nbsp;크기&nbsp;사용<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA(lv_BKTXT)&nbsp;=&nbsp;|생산오더&nbsp;{&nbsp;lv_aufnr&nbsp;},&nbsp;공정순서&nbsp;{&nbsp;&nbsp;ls_log2-plnkn&nbsp;}|.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;데이터&nbsp;생성<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bdc_data&nbsp;USING:&nbsp;'X'&nbsp;&nbsp;'ZCB_MM180'&nbsp;'1000',<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'BDC_CURSOR'&nbsp;'P_CURR',<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'BDC_OKCODE'&nbsp;'=ONLI',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'pa_aufnr'&nbsp;&nbsp;&nbsp;lv_aufnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'PA_BLDAT'&nbsp;&nbsp;&nbsp;sy-datum,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'PA_BKTXT'&nbsp;&nbsp;&nbsp;lv_bktxt.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;트랜잭션&nbsp;호출&nbsp;및&nbsp;메시지&nbsp;수집<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;TRANSACTION&nbsp;'ZCBMM180'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING&nbsp;&nbsp;&nbsp;&nbsp;gt_bdc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPTIONS&nbsp;&nbsp;FROM&nbsp;ls_opt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGES&nbsp;INTO&nbsp;lt_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;메시지&nbsp;처리:&nbsp;마지막&nbsp;메시지를&nbsp;읽어&nbsp;출력<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_index&nbsp;TYPE&nbsp;sy-tabix.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;lt_msg&nbsp;LINES&nbsp;lv_index.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_index&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_msg&nbsp;INTO&nbsp;ls_msg&nbsp;INDEX&nbsp;lv_index.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'MESSAGE_TEXT_BUILD'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgv1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgv2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgv3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgv4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message_text_output&nbsp;=&nbsp;lv_message.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;|{&nbsp;lv_message&nbsp;}&nbsp;MM&nbsp;BDC&nbsp;결과|&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;넘길&nbsp;회계&nbsp;문서&nbsp;데이터가&nbsp;있을경우<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lt_fi&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;이의정&nbsp;배치&nbsp;끔&nbsp;수정용<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;입고자재&nbsp;배치수량&nbsp;감소<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_fi&nbsp;INTO&nbsp;ls_fi.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zcb_pp_batch_cal/zcb_pp_batch_cal.html">'ZCB_PP_BATCH_CAL'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_werks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pa_werks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;플랜트&nbsp;코드&nbsp;CL3&nbsp;2조<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_matnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_fi-matnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;자재&nbsp;번호&nbsp;CL3&nbsp;2조<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_qty&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_fi-menge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;가용재고&nbsp;CL3&nbsp;2조<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;배치결과<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_db_data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;DB에&nbsp;해당&nbsp;조건의&nbsp;데이터가&nbsp;없습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;batch_qty_error&nbsp;=&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;배치&nbsp;수량이,&nbsp;입력&nbsp;수량보다&nbsp;적습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db_update_error&nbsp;=&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;DB&nbsp;업데이트에&nbsp;실패했습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ZCB_PP_BATCH_CAL&nbsp;배치감소&nbsp;오류&nbsp;발생<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e443(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;회계&nbsp;문서&nbsp;생성<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;lv_msg&nbsp;TYPE&nbsp;string..<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zcb_fi_plnnr/zcb_fi_plnnr.html">'ZCB_FI_PLNNR'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_aufnr&nbsp;=&nbsp;lv_aufnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산오더&nbsp;번호&nbsp;CL3&nbsp;2조<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_stlnr&nbsp;=&nbsp;ls_afko-stlnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;bom&nbsp;id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_rout&nbsp;=&nbsp;lt_fi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;라우팅&nbsp;투입&nbsp;자재에&nbsp;대한&nbsp;Table&nbsp;Type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_plnnr&nbsp;=&nbsp;ls_afko-plnnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정번호<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_werks&nbsp;=&nbsp;pa_werks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;플랜트&nbsp;코드&nbsp;CL3&nbsp;2조<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_msg&nbsp;&nbsp;&nbsp;=&nbsp;lv_msg.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ZCB_FI_PLNNR&nbsp;전표&nbsp;생성&nbsp;오류&nbsp;발생<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e444(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;|{&nbsp;lv_msg&nbsp;}&nbsp;전표발행|&nbsp;TYPE&nbsp;'S'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;FORM&nbsp;get_transcation&nbsp;.<br />
*&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;전송을&nbsp;위한&nbsp;ITAB<br />
*&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_bdc_pri&nbsp;TYPE&nbsp;zcb_bom_item.<br />
*&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_bdc_pri&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_bdc_pri.<br />
*<br />
*&nbsp;&nbsp;&nbsp;"&nbsp;회계문서&nbsp;발행을&nbsp;위한&nbsp;ITAB<br />
*&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_fi&nbsp;TYPE&nbsp;zcb_fi_plnnr.<br />
*&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_fi&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_fi.<br />
*<br />
*&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;lt_bdc_pri,&nbsp;lt_fi.<br />
*<br />
*&nbsp;&nbsp;&nbsp;"&nbsp;이번틱에&nbsp;작동하는&nbsp;생산오더&nbsp;저장<br />
*&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_aufnr&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_afko-aufnr.<br />
*<br />
*&nbsp;&nbsp;&nbsp;"&nbsp;현재&nbsp;틱에&nbsp;작동하는&nbsp;오더&nbsp;가져옴<br />
*&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_log&nbsp;INTO&nbsp;DATA(ls_log)&nbsp;WHERE&nbsp;tick&nbsp;=&nbsp;gv_process_status.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;중복&nbsp;체크<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_aufnr&nbsp;WITH&nbsp;KEY&nbsp;=&nbsp;ls_log-aufnr&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_log-aufnr&nbsp;TO&nbsp;lt_aufnr.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
*<br />
*<br />
*&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_aufnr&nbsp;INTO&nbsp;DATA(lv_aufnr).<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;lt_fi,&nbsp;lt_bdc_pri.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_log&nbsp;INTO&nbsp;DATA(ls_log2)&nbsp;WHERE&nbsp;tick&nbsp;=&nbsp;gv_process_status&nbsp;AND&nbsp;aufnr&nbsp;=&nbsp;lv_aufnr.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_log2-matnr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-idnrk&nbsp;=&nbsp;ls_log2-matnr.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afko&nbsp;INTO&nbsp;DATA(ls_afko)&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;lv_aufnr.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-stlnr&nbsp;=&nbsp;ls_afko-stlnr.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_log2-matnr&nbsp;CP&nbsp;'RM*'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-lgort&nbsp;=&nbsp;ls_afko-lgort.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afpo&nbsp;INTO&nbsp;DATA(ls_afpo)&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;lv_aufnr&nbsp;matnr&nbsp;=&nbsp;ls_log2-matnr.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-lgort&nbsp;=&nbsp;ls_afpo-lgort.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-meins&nbsp;=&nbsp;ls_log2-meins.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-menge&nbsp;=&nbsp;ls_log2-menge.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc_pri-werks&nbsp;=&nbsp;pa_werks.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_bdc_pri&nbsp;TO&nbsp;lt_bdc_pri.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fi-matnr&nbsp;=&nbsp;ls_log2-matnr.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fi-meins&nbsp;=&nbsp;ls_log2-meins.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fi-menge&nbsp;=&nbsp;ls_log2-menge.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_fi&nbsp;TO&nbsp;lt_fi.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;넘길&nbsp;회계&nbsp;문서&nbsp;데이터가&nbsp;있을경우<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lt_fi&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;회계&nbsp;문서&nbsp;생성<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;lv_msg&nbsp;TYPE&nbsp;string..<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'ZCB_FI_PLNNR'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_aufnr&nbsp;=&nbsp;lv_aufnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생산오더&nbsp;번호&nbsp;CL3&nbsp;2조<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_stlnr&nbsp;=&nbsp;ls_afko-stlnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;bom&nbsp;id<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_rout&nbsp;=&nbsp;lt_fi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;라우팅&nbsp;투입&nbsp;자재에&nbsp;대한&nbsp;Table&nbsp;Type<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_plnnr&nbsp;=&nbsp;ls_afko-plnnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;공정번호<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_werks&nbsp;=&nbsp;pa_werks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;플랜트&nbsp;코드&nbsp;CL3&nbsp;2조<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_msg&nbsp;&nbsp;&nbsp;=&nbsp;lv_msg.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;|{&nbsp;lv_msg&nbsp;}&nbsp;전표발행|&nbsp;TYPE&nbsp;'S'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;로&nbsp;넘길&nbsp;데이터가&nbsp;있는&nbsp;경우<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lt_bdc_pri&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;자재문서&nbsp;발행을&nbsp;위한&nbsp;ITAB&nbsp;전달<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORT&nbsp;input_material&nbsp;=&nbsp;lt_bdc_pri&nbsp;TO&nbsp;MEMORY&nbsp;ID&nbsp;'ABAP_ZCB_MEMORY'.<br />
*<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"BDC&nbsp;실행<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"----------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_bdc&nbsp;TYPE&nbsp;bdcdata.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;단일&nbsp;레코드&nbsp;작업&nbsp;영역<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_opt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ctu_params.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;CALL&nbsp;TRANSACTION&nbsp;옵션&nbsp;구조<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_msg&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;bdcmsgcoll,&nbsp;"&nbsp;BDC&nbsp;수행&nbsp;후&nbsp;메시지&nbsp;테이블<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_msg&nbsp;TYPE&nbsp;bdcmsgcoll.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;메시지&nbsp;단일&nbsp;레코드&nbsp;작업&nbsp;영역<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_message&nbsp;TYPE&nbsp;string.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;메시지&nbsp;텍스트를&nbsp;담을&nbsp;변수<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gt_bdc[],&nbsp;ls_bdc,&nbsp;ls_opt,&nbsp;lt_msg,&nbsp;ls_msg,&nbsp;lv_message.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_opt-dismode&nbsp;=&nbsp;'E'.&nbsp;&nbsp;&nbsp;"&nbsp;E:&nbsp;오류&nbsp;발생&nbsp;시&nbsp;화면&nbsp;표시&nbsp;,&nbsp;N&nbsp;:&nbsp;화면&nbsp;표시&nbsp;없음.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_opt-updmode&nbsp;=&nbsp;'A'.&nbsp;&nbsp;&nbsp;"&nbsp;A:&nbsp;비동기&nbsp;업데이트<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_opt-defsize&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;"&nbsp;기본&nbsp;윈도우&nbsp;크기&nbsp;사용<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA(lv_BKTXT)&nbsp;=&nbsp;|생산오더&nbsp;{&nbsp;lv_aufnr&nbsp;},&nbsp;공정순서&nbsp;{&nbsp;&nbsp;ls_log2-plnkn&nbsp;}|.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;데이터&nbsp;생성<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bdc_data&nbsp;USING:&nbsp;'X'&nbsp;&nbsp;'ZCB_MM180'&nbsp;'1000',<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'BDC_CURSOR'&nbsp;'P_CURR',<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'BDC_OKCODE'&nbsp;'=ONLI',<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'pa_aufnr'&nbsp;&nbsp;&nbsp;lv_aufnr,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'PA_BLDAT'&nbsp;&nbsp;&nbsp;sy-datum,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;&nbsp;&nbsp;'PA_BKTXT'&nbsp;&nbsp;&nbsp;lv_bktxt.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;트랜잭션&nbsp;호출&nbsp;및&nbsp;메시지&nbsp;수집<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;TRANSACTION&nbsp;'ZCBMM180'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING&nbsp;&nbsp;&nbsp;&nbsp;gt_bdc<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPTIONS&nbsp;&nbsp;FROM&nbsp;ls_opt<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGES&nbsp;INTO&nbsp;lt_msg.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;메시지&nbsp;처리:&nbsp;마지막&nbsp;메시지를&nbsp;읽어&nbsp;출력<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_index&nbsp;TYPE&nbsp;sy-tabix.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;lt_msg&nbsp;LINES&nbsp;lv_index.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_index&nbsp;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_msg&nbsp;INTO&nbsp;ls_msg&nbsp;INDEX&nbsp;lv_index.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'MESSAGE_TEXT_BUILD'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgid<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgnr<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgv1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgv2<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgv3<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg-msgv4<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message_text_output&nbsp;=&nbsp;lv_message.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;|{&nbsp;lv_message&nbsp;}&nbsp;MM&nbsp;BDC&nbsp;결과|&nbsp;TYPE&nbsp;'S'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
*<br />
*<br />
*&nbsp;ENDFORM.<br />
<br />
*---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;BDC_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;설명:<br />
*&nbsp;-&nbsp;pv_check&nbsp;=&nbsp;'X'&nbsp;인&nbsp;경우:&nbsp;프로그램&nbsp;시작&nbsp;레코드&nbsp;생성<br />
*&nbsp;-&nbsp;그렇지&nbsp;않은&nbsp;경우:&nbsp;필드명/필드값&nbsp;레코드&nbsp;생성<br />
*---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;bdc_data&nbsp;USING&nbsp;&nbsp;&nbsp;&nbsp;pv_check<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pv_name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pv_value.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_bdc&nbsp;TYPE&nbsp;bdcdata.<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;ls_bdc.<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;pv_check&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc-program&nbsp;&nbsp;=&nbsp;pv_name.&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;프로그램명<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc-dynpro&nbsp;&nbsp;&nbsp;=&nbsp;pv_value.&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;화면번호<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc-dynbegin&nbsp;=&nbsp;pv_check.&nbsp;&nbsp;&nbsp;"&nbsp;시작&nbsp;레코드&nbsp;표시<br />
&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc-fnam&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_name.&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;필드명<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bdc-fval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_value.&nbsp;&nbsp;&nbsp;"&nbsp;BDC&nbsp;필드값<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_bdc&nbsp;TO&nbsp;gt_bdc.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;생성된&nbsp;레코드를&nbsp;리스트에&nbsp;추가<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;product_completion<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;제품생산완료&nbsp;-&gt;&nbsp;배치&nbsp;발행,&nbsp;AFKO&nbsp;Header&nbsp;정보&nbsp;채움<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;product_completion&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;ls_afko&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;gt_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;REFRESH&nbsp;gt_afko2.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;비고에&nbsp;생산&nbsp;완료가&nbsp;있을&nbsp;경우&nbsp;재품생산이&nbsp;완료된걸로&nbsp;치고<br />
&nbsp;&nbsp;&nbsp;"&nbsp;AFKO&nbsp;에&nbsp;생산결과&nbsp;기입<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_schedule_log&nbsp;INTO&nbsp;DATA(ls_log)&nbsp;WHERE&nbsp;ltxa2&nbsp;CP&nbsp;'*생산완료*'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_afko&nbsp;INTO&nbsp;DATA(ls_afko2)&nbsp;WITH&nbsp;KEY&nbsp;aufnr&nbsp;=&nbsp;ls_log-aufnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;ls_afko.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_afko2&nbsp;TO&nbsp;ls_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_afko&nbsp;TO&nbsp;gt_afko2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;go_alv_grid8&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;alv_refresh_0100&nbsp;USING&nbsp;go_alv_grid8.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;생산실적&nbsp;등록&nbsp;화면&nbsp;이동<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;gt_afko2&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;실적등록&nbsp;화면으로&nbsp;이동합니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;i445(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;300&nbsp;STARTING&nbsp;AT&nbsp;20&nbsp;20.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;set_alv_grid8_0100<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;생산실적&nbsp;등록&nbsp;을&nbsp;위한&nbsp;ALV&nbsp;FCAT&nbsp;LAYO<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;set_alv_grid8_0100&nbsp;.<br />
&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;gs_layo8,&nbsp;gs_variant8&nbsp;,&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_variant8-report&nbsp;=&nbsp;sy-cprog.<br />
&nbsp;&nbsp;&nbsp;gs_variant8-handle&nbsp;=&nbsp;'ALV8'.<br />
<br />
&nbsp;&nbsp;&nbsp;gv_save8&nbsp;=&nbsp;'A'.<br />
<br />
&nbsp;&nbsp;&nbsp;gs_layo8-sel_mode&nbsp;=&nbsp;'B'.&nbsp;"&nbsp;CELL&nbsp;단위&nbsp;선택가능<br />
&nbsp;&nbsp;&nbsp;gs_layo8-zebra&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;얼룩처리<br />
&nbsp;&nbsp;&nbsp;gs_layo8-grid_title&nbsp;=&nbsp;'생산결과&nbsp;등록'.<br />
&nbsp;&nbsp;&nbsp;gs_layo8-no_toolbar&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;gs_layo8-stylefname&nbsp;=&nbsp;'CELLTAB'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;gs_layo3-cwidth_opt&nbsp;=&nbsp;abap_on.&nbsp;"&nbsp;열넓이&nbsp;최적화&nbsp;샐&nbsp;넓이가&nbsp;고정이&nbsp;되어버림&nbsp;최적으로<br />
*&nbsp;&nbsp;gs_layo1-edit&nbsp;=&nbsp;''.&nbsp;"&nbsp;수정모드&nbsp;전체&nbsp;필드가&nbsp;수정&nbsp;가능하게&nbsp;되어짐<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;미사용&nbsp;필드<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR&nbsp;gs_fcat1.<br />
*&nbsp;&nbsp;gs_fcat1-fieldname&nbsp;=&nbsp;'APPROV_T'.<br />
*&nbsp;&nbsp;gs_fcat1-no_out&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;APPEND&nbsp;gs_fcat1&nbsp;TO&nbsp;gt_fcat1.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;사용할&nbsp;필드<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'AUFNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'생산오더'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'AUFNR'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'PLNBEZ'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'자재번호'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'PLNBEZ'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'MAKTX'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'자재설명'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;12.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_MAKT'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'ZCB_MAKTX'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'GSAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'생산수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'GSAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'계획수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'GAMNG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'GASMG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'불량수량'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'GASMG'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-qfieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-edit&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'R'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'단위'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'GSTRI'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'생산시작일'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'GSTRI'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_fcat8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-fieldname&nbsp;=&nbsp;'GLTRI'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-coltext&nbsp;=&nbsp;'생산종료일'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-outputlen&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_table&nbsp;=&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-ref_field&nbsp;=&nbsp;'GLTRI'.<br />
&nbsp;&nbsp;&nbsp;gs_fcat8-just&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_fcat8&nbsp;TO&nbsp;gt_fcat8.<br />
<br />
<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;register_afur<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;생산&nbsp;실적&nbsp;등록<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;register_afur&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:lt_afko&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zcb_afko,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko&nbsp;TYPE&nbsp;zcb_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_msg&nbsp;&nbsp;&nbsp;TYPE&nbsp;char40,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_afko3&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;gt_afko2.<br />
<br />
&nbsp;&nbsp;&nbsp;REFRESH:&nbsp;lt_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_afko2&nbsp;INTO&nbsp;DATA(ls_afko2).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;ls_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ls_afko2&nbsp;TO&nbsp;ls_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;배치&nbsp;번호&nbsp;발행<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;create_batch&nbsp;CHANGING&nbsp;ls_afko.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zcb_pp_time_stamp/zcb_pp_time_stamp.html">'ZCB_PP_TIME_STAMP'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_mode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'U'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;C&nbsp;or&nbsp;U&nbsp;입력하세요&nbsp;(CREATE&nbsp;,&nbsp;UPDATE)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cs_record&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_afko&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;변경하는&nbsp;Structure&nbsp;넣으세요<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_mode&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;잘못된&nbsp;모드&nbsp;입력&nbsp;C&nbsp;or&nbsp;U&nbsp;중에&nbsp;골라야됩니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;missing_record&nbsp;&nbsp;=&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;변경하는&nbsp;Structure&nbsp;넣으세요<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timestamp_error&nbsp;=&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;TIMESTAMP_ERROR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e029(zcb_msg)&nbsp;WITH&nbsp;sy-subrc.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;변경된&nbsp;내용&nbsp;생산오더&nbsp;H&nbsp;에&nbsp;UPDATE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;zcb_afko&nbsp;FROM&nbsp;ls_afko.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;실패&nbsp;처리<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e402(zcb_msg)&nbsp;WITH&nbsp;'ZCB_AFKO'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_afko&nbsp;TO&nbsp;lt_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;"&nbsp;DB&nbsp;UPDATE&nbsp;성공처리<br />
*&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;"&nbsp;생산실적&nbsp;생성<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;create_afru&nbsp;USING&nbsp;lt_afko.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;"&nbsp;DB&nbsp;UPDATE&nbsp;성공처리<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;create_batch<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;생산품에&nbsp;대한&nbsp;배치번호&nbsp;발행<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;create_batch&nbsp;&nbsp;CHANGING&nbsp;ps_afko&nbsp;TYPE&nbsp;zcb_afko.<br />
<br />
&nbsp;&nbsp;&nbsp;"&nbsp;배치&nbsp;번호&nbsp;발행<br />
&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zcb_pp_batch/zcb_pp_batch.html">'ZCB_PP_BATCH'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_batch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_afko<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;es_bath&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_afko<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_input_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;batch_nr_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;batch_create_failed&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ZCB_PP_BATCH&nbsp;배치생성&nbsp;오류&nbsp;발생<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e446(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;sy-subrc.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'입력값이&nbsp;올바르지&nbsp;않습니다.'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;2.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'배치&nbsp;번호&nbsp;생성에&nbsp;실패하였습니다'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;3.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'배치&nbsp;생성&nbsp;중&nbsp;오류가&nbsp;발생하였습니다.'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'알&nbsp;수&nbsp;없는&nbsp;오류가&nbsp;발생했습니다.'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
*&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;성공&nbsp;메시지를&nbsp;출력하거나&nbsp;로그에&nbsp;기록&nbsp;가능<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;|배치가&nbsp;정상&nbsp;생성되었습니다.&nbsp;번호:&nbsp;{&nbsp;ps_afko-aufnr&nbsp;}|&nbsp;TYPE&nbsp;'S'.<br />
*&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;create_afru<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;생산실적을&nbsp;생성한다.<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;create_afru&nbsp;&nbsp;USING&nbsp;&nbsp;&nbsp;&nbsp;pt_afko.<br />
&nbsp;&nbsp;&nbsp;"&nbsp;생산실적&nbsp;생성<br />
&nbsp;&nbsp;&nbsp;call&nbsp;function&nbsp;<a&nbsp;href&nbsp;="zcb_pp_create_afru/zcb_pp_create_afru.html">'ZCB_PP_CREATE_AFRU'</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_afko&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pt_afko<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_input_value&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nr_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db_create_failed&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ZCB_PP_CREATE_AFRU&nbsp;생산실적&nbsp;생성&nbsp;오류&nbsp;발생<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e447(zcb_msg).<br />
&nbsp;&nbsp;&nbsp;ELSE.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_flag_all&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;sy-subrc.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'입력값이&nbsp;없습니다.'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;2.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'넘버레인지&nbsp;생성에&nbsp;실패하였습니다.'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;3.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'DB&nbsp;생성&nbsp;중&nbsp;오류가&nbsp;발생하였습니다.'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'알&nbsp;수&nbsp;없는&nbsp;오류가&nbsp;발생했습니다.'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
*&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'실적이&nbsp;정상적으로&nbsp;생성되었습니다.'(i08)&nbsp;TYPE&nbsp;'I'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_flag_all&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;alv7_valid_check<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;구매요청&nbsp;ALV&nbsp;edit&nbsp;수정&nbsp;값&nbsp;검증<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;alv7_valid_check&nbsp;&nbsp;USING&nbsp;&nbsp;pr_data_changed&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cl_alv_changed_data_protocol.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_good_cells&nbsp;TYPE&nbsp;lvc_t_modi,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_good_cell&nbsp;&nbsp;TYPE&nbsp;lvc_s_modi.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_quantity2&nbsp;TYPE&nbsp;zcb_gasmg.&nbsp;"&nbsp;구매요청&nbsp;수량<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_msg_flag&nbsp;TYPE&nbsp;c&nbsp;VALUE&nbsp;''.&nbsp;"&nbsp;경고&nbsp;메세지&nbsp;여부.<br />
<br />
&nbsp;&nbsp;&nbsp;lt_good_cells[]&nbsp;=&nbsp;pr_data_changed-&gt;mt_good_cells[].<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_good_cells&nbsp;INTO&nbsp;ls_good_cell.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_good_cell-fieldname&nbsp;=&nbsp;'QUANTITY2'.&nbsp;&nbsp;"&nbsp;수정된&nbsp;필드가&nbsp;QUANTITY2인지&nbsp;확인<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;불량갯수&nbsp;처리<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr_data_changed-&gt;get_cell_value(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_row_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_good_cell-row_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Row&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_fieldname&nbsp;=&nbsp;'QUANTITY2'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Field&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;lv_quantity2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Cell&nbsp;Content<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_quantity2&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_msg_flag&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_quantity2&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_flag_eban&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr_data_changed-&gt;modify_cell(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_row_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;ls_good_cell-row_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Row&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_fieldname&nbsp;=&nbsp;&nbsp;&nbsp;'QUANTITY2'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Field&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;lv_quantity2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Value<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;lv_msg_flag&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;구매수량은&nbsp;0보다&nbsp;커야&nbsp;합니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;i448(zcb_msg)&nbsp;DISPLAY&nbsp;LIKE&nbsp;'W'.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;alv8_valid_check<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;실적&nbsp;입력&nbsp;ALV&nbsp;입력값&nbsp;점검<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;alv8_valid_check&nbsp;&nbsp;USING&nbsp;pr_data_changed&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cl_alv_changed_data_protocol.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lt_good_cells&nbsp;TYPE&nbsp;lvc_t_modi,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_good_cell&nbsp;&nbsp;TYPE&nbsp;lvc_s_modi.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_gasmg&nbsp;TYPE&nbsp;zcb_gasmg.&nbsp;"&nbsp;불량수량<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_gamng&nbsp;TYPE&nbsp;zcb_gamng.&nbsp;"&nbsp;계획&nbsp;수량<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_gsamng&nbsp;TYPE&nbsp;zcb_gsamng.&nbsp;"&nbsp;생산&nbsp;수량<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_msg_flag1&nbsp;TYPE&nbsp;c&nbsp;VALUE&nbsp;''.&nbsp;"&nbsp;경고&nbsp;메세지&nbsp;여부.<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_msg_flag2&nbsp;TYPE&nbsp;c&nbsp;VALUE&nbsp;''.&nbsp;"&nbsp;경고&nbsp;메세지&nbsp;여부.<br />
<br />
&nbsp;&nbsp;&nbsp;lt_good_cells[]&nbsp;=&nbsp;pr_data_changed-&gt;mt_good_cells[].<br />
<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_good_cells&nbsp;INTO&nbsp;ls_good_cell.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_good_cell-fieldname&nbsp;=&nbsp;'GASMG'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;불량갯수<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr_data_changed-&gt;get_cell_value(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_row_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_good_cell-row_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Row&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_fieldname&nbsp;=&nbsp;'GASMG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Field&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;lv_gasmg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Cell&nbsp;Content<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;계획&nbsp;갯수<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr_data_changed-&gt;get_cell_value(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_row_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_good_cell-row_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Row&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_fieldname&nbsp;=&nbsp;'GAMNG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Field&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;lv_gamng&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Cell&nbsp;Content<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_gasmg&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_msg_flag1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_gasmg&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_flag_afru&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;lv_gasmg&nbsp;&gt;&nbsp;lv_gamng.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_msg_flag2&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_gasmg&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_gsamng&nbsp;=&nbsp;lv_gamng&nbsp;-&nbsp;&nbsp;lv_gasmg.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_flag_afru&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_flag_afru&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_gsamng&nbsp;=&nbsp;lv_gamng&nbsp;-&nbsp;&nbsp;lv_gasmg.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr_data_changed-&gt;modify_cell(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_row_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;ls_good_cell-row_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Row&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_fieldname&nbsp;=&nbsp;&nbsp;&nbsp;'GASMG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Field&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;lv_gasmg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Value<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pr_data_changed-&gt;modify_cell(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_row_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;ls_good_cell-row_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Row&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_fieldname&nbsp;=&nbsp;&nbsp;&nbsp;'GSAMNG'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Field&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;lv_gsamng&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Value<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;lv_msg_flag1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;불량수량이&nbsp;음수가&nbsp;나올&nbsp;수&nbsp;없습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;i449(zcb_msg)&nbsp;DISPLAY&nbsp;LIKE&nbsp;'W'.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;lv_msg_flag2&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;불량수량이&nbsp;계획수량&nbsp;보다&nbsp;많을&nbsp;수&nbsp;없습니다.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;i450(zcb_msg)&nbsp;DISPLAY&nbsp;LIKE&nbsp;'W'.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;move_current_tick_index<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;공정&nbsp;LOG&nbsp;ALV&nbsp;를&nbsp;현재&nbsp;TICK&nbsp;으로&nbsp;이동<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;FORM&nbsp;move_current_tick_index_log.<br />
<br />
&nbsp;&nbsp;&nbsp;DATA:&nbsp;lv_index&nbsp;TYPE&nbsp;i,&nbsp;"&nbsp;포커싱할&nbsp;행&nbsp;번호<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_rows&nbsp;&nbsp;TYPE&nbsp;lvc_t_row,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_row&nbsp;&nbsp;&nbsp;TYPE&nbsp;lvc_s_row.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;lv_index&nbsp;=&nbsp;lines(&nbsp;gt_schedule_log&nbsp;).&nbsp;"&nbsp;마지막&nbsp;행&nbsp;인덱스<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;lv_index&nbsp;&gt;&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_row-index&nbsp;=&nbsp;lv_index.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_row&nbsp;TO&nbsp;lt_rows.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;전체&nbsp;행&nbsp;하이라이트<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go_alv_grid2-&gt;set_selected_rows(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_index_rows&nbsp;=&nbsp;lt_rows&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;해당&nbsp;행으로&nbsp;스크롤&nbsp;및&nbsp;포커싱&nbsp;이동<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go_alv_grid2-&gt;set_current_cell_via_id(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_row_id&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;index&nbsp;=&nbsp;lv_index&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_column_id&nbsp;=&nbsp;VALUE&nbsp;#(&nbsp;fieldname&nbsp;=&nbsp;'TICK'&nbsp;)&nbsp;).<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2025. Sap Release 758</td>
   </tr>
</table>
</body>
</html>
